// Copyright 2015 Olaf Frohn https://github.com/ofrohn, see LICENSE
!function(){function e(e){var n,a="hr"===e.id||"min"===e.id||"sec"===e.id?1:0;if(e.validity){if(n=e.validity,n.typeMismatch||n.badInput)return t(e,e.title+": check field value"),!1;if(n.rangeOverflow||n.rangeUnderflow)return t(e,e.title+" must be between "+(parseInt(e.min)+a)+" and "+(parseInt(e.max)-a)),!1}else{if(n=e.value,!o(n))return t(e,e.title+": check field value"),!1;if(n=parseFloat(n),n<e.min||n>e.max)return t(e,e.title+" must be between "+(e.min+a)+" and "+(+e.max-a)),!1}return d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),!0}function t(e,t){var n=s(e);d3.select("#error").html(t).style({top:a(n[1]+e.offsetHeight+1),left:a(n[0]),opacity:1}),e.focus()}function n(e){return document.getElementById(e)}function a(e){return e+"px"}function r(e,t){return null!==e&&hasOwnProperty.call(e,t)}function o(e){return!isNaN(parseFloat(e))&&isFinite(e)}function s(e){var t=0,n=0,a=e.offsetWidth,r=e.offsetHeight;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(null!==(e=e.offsetParent));return{l:t,t:n,w:a,h:r}}function i(e){if(e){var t=e.split(".");if(!(t.length<1)&&(t=t[0].split("-"),t[0]=t[0].replace(/\D/g,""),t[0]))return t[1]=t[1]?t[1].replace(/\D/g,""):"1",t[2]=t[2]?t[2].replace(/\D/g,""):"1",new Date(t[0],t[1]-1,t[2])}}function c(e,t,n){var a,r=e.valueOf();if(!t)return new Date(r);switch(a=n||"d"){case"y":case"yr":r+=31556926080*t;break;case"m":case"mo":r+=26298e5*t;break;case"d":case"dy":r+=864e5*t;break;case"h":case"hr":r+=36e5*t;break;case"n":case"mn":r+=6e4*t;break;case"s":case"sec":r+=1e3*t;break;case"ms":r+=t}return new Date(r)}function l(e,t,n){if(t&&e){var a=t.valueOf()-e.valueOf(),r=n||"d";switch(r){case"y":case"yr":a/=31556926080;break;case"m":case"mo":a/=26298e5;break;case"d":case"dy":a/=864e5;break;case"h":case"hr":a/=36e5;break;case"n":case"mn":a/=6e4;break;case"s":case"sec":a/=1e3;break;case"ms":}return n?Math.floor(a):a}}function u(e){return(e.getHours()+e.getTimezoneOffset()/60+e.getMinutes()/60+e.getSeconds()/3600)/24}function d(e,t){for(var n=t>1?e*e:-e*e,a=t*n*e/6,r=(1-t)*e-a,o=4;Math.abs(a)>1e-15;)a*=n/(o*(o+1)),r-=a,o+=2;return r}function p(e){var t,n,a,r,o=e.e,s=e.M,i=1e-8,c=0,l=1.9,u=!1,p=0;if(!s)return 0;if(1>o&&((s<-Math.PI||s>Math.PI)&&(r=k.normalize0(s),c=s-r,s=r),.9>o)){t=Math.atan2(Math.sin(s),Math.cos(s)-o);do n=(t-o*Math.sin(t)-s)/(1-o*Math.cos(t)),t-=n;while(Math.abs(n)>i);return t}if(0>s&&(s=-s,u=!0),t=s,i*=Math.abs(1-o),1e-15>i&&(i=1e-15),(o>.8&&s<Math.PI/3||o>1)&&(a=s/Math.abs(1-o),a*a>6*Math.abs(1-o)&&(a=s<Math.PI?Math.pow(6*s,1/3):k.asinh(s/o)),t=a),o>1&&s>4&&(t=Math.log(s)),1>o)for(;Math.abs(l)>i;)n=p++>8?d(t,o)-s:t-o*Math.sin(t)-s,l=-n/(1-o*Math.cos(t)),t+=l;else for(;Math.abs(l)>i;)n=p++>7?-d(t,o)-s:o*k.sinh(t)-t-s,l=-n/(o*k.cosh(t)-1),t+=l;return u?c-t:c+t}function h(e){var t,n,a,r,o;1===e.e?(o=e.jd0-e.T,r=e.w0*o*.5,n=Math.pow(r+Math.sqrt(r*r+1),1/3),e.v=2*Math.atan(n-1/n)):(e.E=p(e),e.e>1?(t=e.e-k.cosh(e.E),n=k.sinh(e.E)):(t=Math.cos(e.E)-e.e,n=Math.sin(e.E)),n*=Math.sqrt(Math.abs(1-e.e*e.e)),e.v=Math.atan2(n,t)),a=e.q*(1+e.e),e.r=a/(1+e.e*Math.cos(e.v))}function m(e){e.hasOwnProperty("w")||(e.w=e.W-e.N),e.hasOwnProperty("M")||(e.M=e.L-e.W),e.e<1&&(e.M=k.normalize0(e.M)),e.P=Math.pow(Math.abs(e.a),1.5),e.T=e.jd0-e.M/Math.PI/2/e.P,1!==e.e?(e.q=e.a*(1-e.e),e.t0=e.a*Math.sqrt(Math.abs(e.a)/C)):(e.w0=3/Math.sqrt(2)/(e.q*Math.sqrt(e.q/C)),e.a=0,e.t0=0),e.am=Math.sqrt(C*e.q*(1+e.e))}function f(e){var t,n,a,r=e.v+e.w;return t=e.r*(Math.cos(e.N)*Math.cos(r)-Math.sin(e.N)*Math.sin(r)*Math.cos(e.i)),n=e.r*(Math.sin(e.N)*Math.cos(r)+Math.cos(e.N)*Math.sin(r)*Math.cos(e.i)),a=e.r*(Math.sin(r)*Math.sin(e.i)),e.x=t,e.y=n,e.z=a,{x:t,y:n,z:a}}function E(e){var t,n;return t=Math.atan2(e.y,e.x),n=Math.atan2(e.z,Math.sqrt(e.x*e.x+e.y*e.y)),e.l=k.normalize(t),e.b=n,{l:t,b:n}}function v(e){var t,n,a,r=e.getUTCFullYear(),o=e.getUTCMonth()+1,s=e.getUTCDate(),i=u(e),c=0,l=0,d=2400000.5,p=-4799,h=[31,28,31,30,31,30,31,31,30,31,30,31];return p>r?-1:1>o||o>12?-2:(2!==o||r%4!==0||r%100===0&&r%400!==0||(l=1),(1>s||s>h[o-1]+l)&&(c=-3),t=(o-14)/12,n=r+t,a=1461*(n+4800)/4+367*(o-2-12*t)/12-3*((n+4900)/100)/4+s-2432076,a+d+i)}function g(){requestAnimationFrame(function e(t){requestAnimationFrame(e),q=q||t-1e3/60;var n=Math.min(200,t-q);q=t,F.forEach(function(e){e(n/1e3,t/1e3)})})}var b=b||{};b.Planets={},b.Planets.baseURL="maps/",b.Planets.params={sol:{map:"sunmap.jpg",radius:.12,tilt:7.25,rot:1.0438,corona:{map:"solarcorona.jpg",radius:.53}},mer:{map:"mercurymap.jpg",bump:"mercurybump.jpg",radius:.03,tilt:0,rot:58.646},ven:{map:"venusmap.jpg",radius:.04,tilt:177.3,rot:4.05},ter:{map:"earthmap.jpg",bump:"earthbump.jpg",clouds:"earthclouds.png",radius:.04,tilt:23.45,rot:.9973},lun:{map:"moonmap.jpg",bump:"moonbump.jpg",radius:.025,tilt:1.54,rot:27.3217},mar:{map:"marsmap.jpg",bump:"marsbump.jpg",clouds:"marsclouds.png",radius:.035,tilt:25.19,rot:1.026},ves:{map:"vestamap.jpg",bump:"vestabump.jpg",radius:.01,tilt:29,rot:.223},cer:{map:"ceresmap.jpg",radius:.016,tilt:4,rot:.378},jup:{map:"jupitermap.jpg",radius:.12,tilt:3.12,rot:.414,ring:{map:"jupiterrings.png",radius:.27,opacity:.5}},sat:{map:"saturnmap.jpg",radius:.12,tilt:26.73,rot:.444,ring:{map:"saturnrings.png",radius:.26,opacity:1}},ura:{map:"uranusmap.jpg",radius:.1,tilt:97.86,rot:.718,ring:{map:"uranusrings.png",radius:.2,opacity:.5}},nep:{map:"neptunemap.jpg",radius:.1,tilt:29.56,rot:.671,ring:{map:"neptunerings.png",radius:.25,opacity:.8}},plu:{map:"plutomap.jpg",radius:.02,tilt:122.53,rot:6.387}};var y={Sun:"sol",Mercury:"mer",Venus:"ven",Earth:"ter",Moon:"lun",Mars:"mar",Vesta:"ves",Ceres:"cer",Jupiter:"jup",Saturn:"sat",Uranus:"ura",Neptune:"nep",Pluto:"plu"};b.Planets.createSun=function(){return b.Planets.create("sun")},b.Planets.createMercury=function(){return b.Planets.create("mercury")},b.Planets.createVenus=function(){return b.Planets.create("venus")},b.Planets.createEarth=function(){return b.Planets.create("earth",!0)},b.Planets.createMoon=function(){return b.Planets.create("moon")},b.Planets.createMars=function(){return b.Planets.create("mars")},b.Planets.createJupiter=function(){return b.Planets.create("jupiter")},b.Planets.createJupiterRing=function(){return b.Planets.createRing("jupiter")},b.Planets.createSaturn=function(){return b.Planets.create("saturn",!0)},b.Planets.createSaturnRing=function(){return b.Planets.createRing("saturn")},b.Planets.createUranus=function(){return b.Planets.create("uranus",!0)},b.Planets.createUranusRing=function(){return b.Planets.createRing("uranus")},b.Planets.createNeptune=function(){return b.Planets.create("neptune")},b.Planets.createNeptuneRing=function(){return b.Planets.createRing("neptune")},b.Planets.createPluto=function(){return b.Planets.create("pluto")},b.Planets.createStarfield=function(){var e=new THREE.TextureLoader,t=e.load(b.Planets.baseURL+"tycho-skymap.jpg"),n=new THREE.MeshBasicMaterial({map:t,side:THREE.BackSide}),a=new THREE.SphereGeometry(100,32,32),r=new THREE.Mesh(a,n);return r},b.Planets.create=function(e,t){if(!b.Planets.params.hasOwnProperty(e)){if(!y.hasOwnProperty(e))return console.log("Object not found: "+e),null;e=y[e]}var n=b.Planets.params[e],a={},r=new THREE.TextureLoader,o=new THREE.SphereGeometry(n.radius,32,32);if(a.map=r.load(b.Planets.baseURL+n.map),n.hasOwnProperty("bump")&&(a.bumpMap=r.load(b.Planets.baseURL+n.bump),a.bumpScale=.001),n.hasOwnProperty("spec")&&(a.specularMap=r.load(b.Planets.baseURL+n.spec)),a.specular=new THREE.Color(3355443),a.shininess=.1,"sol"===e)var s=new THREE.MeshBasicMaterial(a);else var s=new THREE.MeshPhongMaterial(a);var i=new THREE.Mesh(o,s);if(!t&&n.hasOwnProperty("ring")){i.receiveShadow=!0,i.castShadow=!0;var c=b.Planets.createRings(e);c.receiveShadow=!0,c.castShadow=!0,i.add(c)}return!t&&n.hasOwnProperty("clouds")&&i.add(b.Planets.createClouds(e)),t||"sol"!==e||i.add(b.Planets.createCorona()),i.rotation.set(0,0,THREE.Math.degToRad(n.tilt)),i},b.Planets.createRings=function(e){if(!b.Planets.params.hasOwnProperty(e)){if(!y.hasOwnProperty(e))return console.log("Object not found: "+e),null;e=y[e]}if(!b.Planets.params[e].hasOwnProperty("ring"))return console.log("Rings not found: "+e),null;var t=b.Planets.params[e],n=b.Planets.baseURL+t.ring.map,a=new THREE.TextureLoader,r=new b.Planets.RingGeometry(1.05*t.radius,t.ring.radius,64,64),o=new THREE.MeshPhongMaterial({map:a.load(n),side:THREE.DoubleSide,transparent:!0,opacity:t.ring.opacity}),s=new THREE.Mesh(r,o);return s.lookAt(new THREE.Vector3(0,1,0)),s.name=e+"rings",s},b.Planets.createClouds=function(e){if(!b.Planets.params.hasOwnProperty(e)){if(!y.hasOwnProperty(e))return console.log("Object not found: "+e),null;e=y[e]}if(!b.Planets.params[e].hasOwnProperty("clouds"))return console.log("Clouds not found: "+e),null;var t=b.Planets.params[e],n=b.Planets.baseURL+t.clouds,a=new THREE.TextureLoader,r=new THREE.Mesh(new THREE.SphereGeometry(1.01*t.radius,32,32),new THREE.MeshPhongMaterial({map:a.load(n),transparent:!0}));return r.name=e+"clouds",r},b.Planets.createCorona=function(){var e=b.Planets.params.sol,t=b.Planets.baseURL+e.corona.map,n=new THREE.SpriteMaterial({map:(new THREE.TextureLoader).load(t),color:16777011,transparent:!1,blending:THREE.AdditiveBlending}),a=new THREE.Sprite(n);return a.scale.multiplyScalar(e.corona.radius),a.name="solcorona",a},b.Planets.RingGeometry=function(e,t,n,a,r,o){THREE.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:a,thetaStart:r,thetaLength:o},e=e||0,t=t||50,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8,a=void 0!==a?Math.max(1,a):8;var s,i,c=[],l=e,u=(t-e)/a;for(s=0;a+1>s;s++){for(i=0;n+1>i;i++){var d=new THREE.Vector3,p=r+i/n*o;d.x=l*Math.cos(p),d.y=l*Math.sin(p),this.vertices.push(d),c.push(new THREE.Vector2(s/(n-1),i/(a-1)))}l+=u}var h=new THREE.Vector3(0,0,1);for(s=0;a>s;s++){var m=s*(n+1);for(i=0;n>i;i++){var p=i+m,f=p,E=p+n+1,v=p+n+2;this.faces.push(new THREE.Face3(f,E,v,[h.clone(),h.clone(),h.clone()])),this.faceVertexUvs[0].push([c[f].clone(),c[E].clone(),c[v].clone()]),f=p,E=p+n+2,v=p+1,this.faces.push(new THREE.Face3(f,E,v,[h.clone(),h.clone(),h.clone()])),this.faceVertexUvs[0].push([c[f].clone(),c[E].clone(),c[v].clone()])}}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,l)},b.Planets.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),b.Planets.RingGeometry.prototype.constructor=b.Planets.RingGeometry,THREE.OrbitControls=function(e,t){function n(){return 2*Math.PI/60/60*D.autoRotateSpeed}function a(){return Math.pow(.95,D.zoomSpeed)}function r(e){Z-=e}function o(e){Y-=e}function s(e){D.object instanceof THREE.PerspectiveCamera?q/=e:D.object instanceof THREE.OrthographicCamera?(D.object.zoom=Math.max(D.minZoom,Math.min(D.maxZoom,D.object.zoom*e)),D.object.updateProjectionMatrix(),W=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),D.enableZoom=!1)}function i(e){D.object instanceof THREE.PerspectiveCamera?q*=e:D.object instanceof THREE.OrthographicCamera?(D.object.zoom=Math.max(D.minZoom,Math.min(D.maxZoom,D.object.zoom/e)),D.object.updateProjectionMatrix(),W=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),D.enableZoom=!1)}function c(e){B.set(e.clientX,e.clientY)}function l(e){$.set(e.clientX,e.clientY)}function u(e){_.set(e.clientX,e.clientY)}function d(e){X.set(e.clientX,e.clientY),K.subVectors(X,B);var t=D.domElement===document?D.domElement.body:D.domElement;r(2*Math.PI*K.x/t.clientWidth*D.rotateSpeed),o(2*Math.PI*K.y/t.clientHeight*D.rotateSpeed),B.copy(X),D.update()}function p(e){ee.set(e.clientX,e.clientY),te.subVectors(ee,$),te.y>0?s(a()):te.y<0&&i(a()),$.copy(ee),D.update()}function h(e){J.set(e.clientX,e.clientY),Q.subVectors(J,_),re(Q.x,Q.y),_.copy(J),D.update()}function m(e){}function f(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?i(a()):0>t&&s(a()),D.update()}function E(e){switch(e.keyCode){case D.keys.UP:re(0,D.keyPanSpeed),D.update();break;case D.keys.BOTTOM:re(0,-D.keyPanSpeed),D.update();break;case D.keys.LEFT:re(D.keyPanSpeed,0),D.update();break;case D.keys.RIGHT:re(-D.keyPanSpeed,0),D.update()}}function v(e){B.set(e.touches[0].pageX,e.touches[0].pageY)}function g(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);$.set(0,a)}function b(e){_.set(e.touches[0].pageX,e.touches[0].pageY)}function y(e){X.set(e.touches[0].pageX,e.touches[0].pageY),K.subVectors(X,B);var t=D.domElement===document?D.domElement.body:D.domElement;r(2*Math.PI*K.x/t.clientWidth*D.rotateSpeed),o(2*Math.PI*K.y/t.clientHeight*D.rotateSpeed),B.copy(X),D.update()}function w(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);ee.set(0,r),te.subVectors(ee,$),te.y>0?i(a()):te.y<0&&s(a()),$.copy(ee),D.update()}function M(e){J.set(e.touches[0].pageX,e.touches[0].pageY),Q.subVectors(J,_),re(Q.x,Q.y),_.copy(J),D.update()}function P(e){}function R(e){if(D.enabled!==!1){if(e.preventDefault(),e.button===D.mouseButtons.ORBIT){if(D.enableRotate===!1)return;c(e),V=U.ROTATE}else if(e.button===D.mouseButtons.ZOOM){if(D.enableZoom===!1)return;l(e),V=U.DOLLY}else if(e.button===D.mouseButtons.PAN){if(D.enablePan===!1)return;u(e),V=U.PAN}V!==U.NONE&&(document.addEventListener("mousemove",T,!1),document.addEventListener("mouseup",H,!1),document.addEventListener("mouseout",H,!1),D.dispatchEvent(I))}}function T(e){if(D.enabled!==!1)if(e.preventDefault(),V===U.ROTATE){if(D.enableRotate===!1)return;d(e)}else if(V===U.DOLLY){if(D.enableZoom===!1)return;p(e)}else if(V===U.PAN){if(D.enablePan===!1)return;h(e)}}function H(e){D.enabled!==!1&&(m(e),document.removeEventListener("mousemove",T,!1),document.removeEventListener("mouseup",H,!1),document.removeEventListener("mouseout",H,!1),D.dispatchEvent(A),V=U.NONE)}function O(e){D.enabled!==!1&&D.enableZoom!==!1&&V===U.NONE&&(e.preventDefault(),e.stopPropagation(),f(e),D.dispatchEvent(I),D.dispatchEvent(A))}function x(e){D.enabled!==!1&&D.enableKeys!==!1&&D.enablePan!==!1&&E(e)}function j(e){if(D.enabled!==!1){switch(e.touches.length){case 1:if(D.enableRotate===!1)return;v(e),V=U.TOUCH_ROTATE;break;case 2:if(D.enableZoom===!1)return;g(e),V=U.TOUCH_DOLLY;break;case 3:if(D.enablePan===!1)return;b(e),V=U.TOUCH_PAN;break;default:V=U.NONE}V!==U.NONE&&D.dispatchEvent(I)}}function L(e){if(D.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(D.enableRotate===!1)return;if(V!==U.TOUCH_ROTATE)return;y(e);break;case 2:if(D.enableZoom===!1)return;if(V!==U.TOUCH_DOLLY)return;w(e);break;case 3:if(D.enablePan===!1)return;if(V!==U.TOUCH_PAN)return;M(e);break;default:V=U.NONE}}function k(e){D.enabled!==!1&&(P(e),D.dispatchEvent(A),V=U.NONE)}function C(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return z},this.getAzimuthalAngle=function(){return S},this.reset=function(){D.target.copy(D.target0),D.object.position.copy(D.position0),D.object.zoom=D.zoom0,D.object.updateProjectionMatrix(),D.dispatchEvent(N),D.update(),V=U.NONE},this.update=function(){var t=new THREE.Vector3,a=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),o=a.clone().inverse(),s=new THREE.Vector3,i=new THREE.Quaternion;return function(){var e=D.object.position;t.copy(e).sub(D.target),t.applyQuaternion(a),S=Math.atan2(t.x,t.z),z=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y),D.autoRotate&&V===U.NONE&&r(n()),S+=Z,z+=Y,S=Math.max(D.minAzimuthAngle,Math.min(D.maxAzimuthAngle,S)),z=Math.max(D.minPolarAngle,Math.min(D.maxPolarAngle,z)),z=Math.max(F,Math.min(Math.PI-F,z));var c=t.length()*q;return c=Math.max(D.minDistance,Math.min(D.maxDistance,c)),D.target.add(G),t.x=c*Math.sin(z)*Math.sin(S),t.y=c*Math.cos(z),t.z=c*Math.sin(z)*Math.cos(S),t.applyQuaternion(o),e.copy(D.target).add(t),D.object.lookAt(D.target),D.enableDamping===!0?(Z*=1-D.dampingFactor,Y*=1-D.dampingFactor):(Z=0,Y=0),q=1,G.set(0,0,0),W||s.distanceToSquared(D.object.position)>F||8*(1-i.dot(D.object.quaternion))>F?(D.dispatchEvent(N),s.copy(D.object.position),i.copy(D.object.quaternion),W=!1,!0):!1}}(),this.dispose=function(){D.domElement.removeEventListener("contextmenu",C,!1),D.domElement.removeEventListener("mousedown",R,!1),D.domElement.removeEventListener("mousewheel",O,!1),D.domElement.removeEventListener("MozMousePixelScroll",O,!1),D.domElement.removeEventListener("touchstart",j,!1),D.domElement.removeEventListener("touchend",k,!1),D.domElement.removeEventListener("touchmove",L,!1),document.removeEventListener("mousemove",T,!1),document.removeEventListener("mouseup",H,!1),document.removeEventListener("mouseout",H,!1),window.removeEventListener("keydown",x,!1)};var S,z,D=this,N={type:"change"},I={type:"start"},A={type:"end"},U={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},V=U.NONE,F=1e-6,Y=0,Z=0,q=1,G=new THREE.Vector3,W=!1,B=new THREE.Vector2,X=new THREE.Vector2,K=new THREE.Vector2,_=new THREE.Vector2,J=new THREE.Vector2,Q=new THREE.Vector2,$=new THREE.Vector2,ee=new THREE.Vector2,te=new THREE.Vector2,ne=function(){var e=new THREE.Vector3;return function(t,n){var a=n.elements;e.set(a[0],a[1],a[2]),e.multiplyScalar(-t),G.add(e)}}(),ae=function(){var e=new THREE.Vector3;return function(t,n){var a=n.elements;e.set(a[4],a[5],a[6]),e.multiplyScalar(t),G.add(e)}}(),re=function(){var e=new THREE.Vector3;return function(t,n){var a=D.domElement===document?D.domElement.body:D.domElement;if(D.object instanceof THREE.PerspectiveCamera){var r=D.object.position;e.copy(r).sub(D.target);var o=e.length();o*=Math.tan(D.object.fov/2*Math.PI/180),ne(2*t*o/a.clientHeight,D.object.matrix),ae(2*n*o/a.clientHeight,D.object.matrix)}else D.object instanceof THREE.OrthographicCamera?(ne(t*(D.object.right-D.object.left)/a.clientWidth,D.object.matrix),ae(n*(D.object.top-D.object.bottom)/a.clientHeight,D.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),D.enablePan=!1)}}();D.domElement.addEventListener("contextmenu",C,!1),D.domElement.addEventListener("mousedown",R,!1),D.domElement.addEventListener("mousewheel",O,!1),D.domElement.addEventListener("MozMousePixelScroll",O,!1),D.domElement.addEventListener("touchstart",j,!1),D.domElement.addEventListener("touchend",k,!1),D.domElement.addEventListener("touchmove",L,!1),window.addEventListener("keydown",x,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.constraint.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.constraint.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor=e}}});var w,M,P,R,T,H,O,x,j=function(t){function n(e){var t=I.node(),n=d3.select(O).node(),o=r(t,n);-9999===t.offsetTop?(w.setTime(e.valueOf()),f(),I.style({top:a(o[1]),left:a(o[0]),opacity:1}),d3.select(n).classed("active",!0)):E()}function r(e,t){var n=s(t),a="left"===N[0]?n.l:n.l+n.w-e.offsetWidth,r="top"===N[1]?n.t-e.offsetHeight-1:n.t+n.h-1;return[a,r]}function o(){var e,t=d3.select("#cal"),n=d3.select("#mon").node().value,a=d3.select("#yr").node().value,r=new Date,o=S;t.node()||(t=I.append("div").attr("id","cal")),a=parseInt(a),n=g(n);var s=new Date(a,n,1);s.setDate(s.getDate()-s.getDay()+o);for(var i=t.node();i.firstChild;)i.removeChild(i.firstChild);if(k===!0)for(e=o;o+7>e;e++){var c=e>6?e-7:e;t.append("div").classed({date:!0,weekday:!0}).html(T[c])}for(e=0;42>e;e++){var u=s.getMonth(),d=s.getDay(),p=b(s);t.append("div").classed({date:!0,grey:u!==n,weekend:u===n&&(0===d||6===d),today:0===l(s,r,"d"),selected:0===l(s,w,"d")}).attr("id",p).on("click",v).html(s.getDate().toString()),s.setDate(s.getDate()+1)}}function i(){var e=w.getFullYear();if(C===!0){var t=I.append("select").attr("title","Year").attr("id","yr").on("change",o).on("keyup",o),n=0;t.selectAll("option").data(H).enter().append("option").text(function(t,a){return t===e&&(n=a),t.toString()}),t.property("selectedIndex",n)}else I.append("input").attr("type","text").attr("title","Year").attr("id","yr").attr("readonly","readonly").attr("value",e)}function c(){var e=w.getMonth();if(C===!0){var t=I.append("select").attr("title","Month").attr("id","mon").on("change",o).on("keyup",o),n=0;t.selectAll("option").data(R).enter().append("option").attr("value",function(t,a){return a===e&&(n=a),a}).text(function(e){return e}),t.property("selectedIndex",n)}else I.append("input").attr("type","text").attr("title","Month").attr("id","mon").attr("readonly","readonly").attr("value",R[e])}function u(e){I.append("div").attr("id",e).on("click",function(){var t=d3.select("#mon").node(),n=d3.select("#yr").node();if("select"===t.tagName.toLowerCase())"left"===e?0===t.selectedIndex?(t.selectedIndex=11,n.selectedIndex--):t.selectedIndex--:11===t.selectedIndex?(t.selectedIndex=0,n.selectedIndex++):t.selectedIndex++;else{var a=g(t.value),r=parseInt(n.value);"left"===e?0===a?(a=11,r--):a--:11===a?(a=0,r++):a++,t.value=R[a],n.value=r}o()})}function d(){j!==!1&&(I.append("input").attr("type","number").attr("id","hr").attr("title","Hours").attr("max","24").attr("min","-1").attr("step","1").attr("value",w.getHours()).on("change",function(){e(this)===!0&&v()}),I.append("input").attr("type","number").attr("id","min").attr("title","Minutes").attr("max","60").attr("min","-1").attr("step","1").attr("value",w.getMinutes()).on("change",function(){e(this)===!0&&v()}),I.append("input").attr("type","number").attr("id","sec").attr("title","Seconds").attr("max","60").attr("min","-1").attr("step","1").attr("value",w.getSeconds()).on("change",function(){e(this)===!0&&v()}),L===!0&&p())}function p(){var e=I.append("select").attr("title","Time zone offset from UTC").attr("id","tz").on("change",v),t=15;M=w.getTimezoneOffset(),e.selectAll("option").data(P).enter().append("option").attr("value",function(e,n){var a=Object.keys(e)[0];return e[a]===M&&(t=n),e[a]}).text(function(e){return Object.keys(e)[0]}),e.property("selectedIndex",t)}function h(e){for(var t=e.getFullYear(),n=[],a=t-10;t+10>=a;a++)n.push(a);return n}function m(e,t){var n=d3.select(e).node();if("select"===n.tagName.toLowerCase()){for(var a=0;a<n.childNodes.length;a++)if(n.childNodes[a].value==t){n.selectedIndex=a;break}}else"mon"===n.id?n.value=R[t]:n.value=t}function f(){m("#yr",w.getFullYear()),m("#mon",w.getMonth()),o(),j&&(d3.select("#hr").node().value=w.getHours(),d3.select("#min").node().value=w.getMinutes(),d3.select("#sec").node().value=w.getSeconds())}function E(){I.style("opacity",0),d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),d3.select(O).classed("active",!1),setTimeout(function(){I.style("top",a(-9999))},600)}function v(){if(this.id&&-1!==this.id.search(/^\d/)&&(w=b.parse(this.id)),j===!0){var e=d3.select("#hr").node().value,t=d3.select("#min").node().value,n=d3.select("#sec").node().value;M=d3.select("#tz").node().value,w.setHours(e,t,n)}f(),D&&D(w,M),z===!0&&E()}function g(e){for(var t=0;t<R.length;t++)if(R[t]===e)return t}var b,y=t||{},w=new Date,M=w.getTimezoneOffset(),P=(d3.time.format("%Z"),[{"−12:00":720},{"−11:00":660},{"−10:00":600},{"−09:30":570},{"−09:00":540},{"−08:00":480},{"−07:00":420},{"−06:00":360},{"−05:00":300},{"−04:30":270},{"−04:00":240},{"−03:30":210},{"−03:00":180},{"−02:00":120},{"−01:00":60},{"±00:00":0},{"+01:00":-60},{"+02:00":-120},{"+03:00":-180},{"+03:30":-210},{"+04:00":-240},{"+04:30":-270},{"+05:00":-300},{"+05:30":-330},{"+05:45":-345},{"+06:00":-360},{"+06:30":-390},{"+07:00":-420},{"+08:00":-480},{"+08:30":-510},{"+08:45":-525},{"+09:00":-540},{"+09:30":-570},{"+10:00":-600},{"+10:30":-630},{"+11:00":-660},{"+12:00":-720},{"+12:45":-765},{"+13:00":-780},{"+14:00":-840}]),R=["January","February","March","April","May","June","July","August","September","October","November","December"],T=["Su","M","Tu","W","Th","F","Sa"],H=h(w),O=y.target||"",x=y.id||"datetimepicker",j=y.hasOwnProperty("time")?y.time:!0,L=y.hasOwnProperty("timezone")?y.timezone:!0,k=y.hasOwnProperty("weekdays")?y.weekdays:!0,C=y.hasOwnProperty("dateselect")?y.dateselect:!0,S=y.hasOwnProperty("startofweek")?y.startofweek:0,z=y.hasOwnProperty("vanishonpick")?y.vanishobpick:!0,D=y.callback||null,N=y.position||["left","top"];b=y.format?d3.time.format(y.format):d3.time.format("%Y-%m-%d");var I=d3.select("body").append("div").attr("id",x);return u("left"),c(),i(),u("right"),o(),d(),this.show=function(e){},this.isVisible=function(){return-9999!==I.node().offsetTop},this.hide=function(){E()},n.target=function(e){return arguments.length?(O=0!==e.indexOf("#")?"#"+e:e,n):O},n.dateFormat=function(e){return arguments.length?(b=d3.time.format(e),n):b},n.callback=function(e){return arguments.length?(D=e,n):D},n.date=function(){return b(w)},n},L=Math.PI/180,k={sinh:function(e){return(Math.pow(Math.E,e)-Math.pow(Math.E,-e))/2},cosh:function(e){return(Math.pow(Math.E,e)+Math.pow(Math.E,-e))/2},tanh:function(e){return 2/(1+Math.exp(-2*e))-1},asinh:function(e){return Math.log(e+Math.sqrt(e*e+1))},acosh:function(e){return Math.log(e+Math.sqrt(e*e-1))},normalize0:function(e){return(e+3*Math.PI)%(2*Math.PI)-Math.PI},normalize:function(e){return(e+2*Math.PI)%(2*Math.PI)},cartesian:function(e){var t=e[0]*L,n=e[1]*L,a=e[2];return[a*Math.sin(n)*Math.cos(t),a*Math.sin(n)*Math.sin(t),a*Math.cos(n)]},spherical:function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),n=Math.atan(e.y/e.x),a=Math.acos(e.z/t);return[n/L,a/L,t]}},C=Math.pow(.01720209895,2),S=function(e,t,n){var a,o,s,c={},l=["a","e","i","w","M","L","W","N","n"];for(n&&(C=n),t&&(a=t instanceof Date?t:i(t)),a||(a=new Date),c.jd=v(a),a=i(e.ep),c.jd0=v(a),c.d=c.jd-c.jd0,c.cy=c.d/36525,o=0;o<l.length;o++)s=l[o],r(e,"d"+s)?c[s]=e[s]+e["d"+s]*c.cy:r(e,s)&&(c[s]=e[s]),r(c,s)&&(-1===s.search(/a|e/)?c[s]*=Math.PI/180:c[s]*=1);return r(c,"M")&&!r(c,"dM")&&r(c,"n")&&(c.M+=c.n*c.d),m(c),h(c),f(c),E(c),c},z=function(e,t){var n=N(e,t.elements);if(!r(t.elements[n],"d")){var a=t.elements[n],o=S(a,e),s={name:t.name,pos:[-o.y,o.z,-o.x],elements:t.elements};return t.H&&""!==t.H?s.r=13-t.H:t.r&&""!==t.r?s.r=t.r:s.r=20,t.icon&&""!==t.icon&&(s.icon=t.icon),s}},D=function(e,t){var n=N(e,t.elements);if(!r(t.elements[n],"d")){var a=S(t.elements[n],e);return t.pos=[-a.y,a.z,-a.x],t.pos}},N=function(e,t){var n=0;if(t.length>1)for(var a=0;a<t.length;a++)if(l(new Date(Date.parse(t[a].ep)),e)<=0){n=0===a?0:a-1;break}return n},I=function(e,t){for(var n,a,r=t.elements[0],o=S(r,e),s=new THREE.Geometry,i=o.P,u=c(e,i,"y"),d=l(e,u)/90,p=new Date(e.valueOf());l(p,u)>0;)a=S(r,p),s.vertices.push(new THREE.Vector3(-a.y,a.z,-a.x)),n=a.z>=0?10066329:6710886,s.colors.push(new THREE.Color(n)),p=c(p,d);return s},A={width:0,height:0,date:!0,dateformat:"%Y-%m-%d",container:"orrery-map",datapath:"data/",imagepath:"images/",planets:{show:!0,image:!0,trajectory:!0,size:null},sbos:{show:!0,image:!1,text:!0,trajectory:!1,size:null},spacecraft:{show:!1,image:!1,text:!0,trajectory:!1,size:null},other:[],set:function(e){var t,n={};if(!e)return this;for(var a in this)if(r(this,a)&&"function"!=typeof this[a])if(r(e,a)&&null!==e[a])if(null===this[a]||this[a].constructor!=Object)n[a]=e[a];else{n[a]={};for(t in this[a])r(e[a],t)?n[a][t]=e[a][t]:n[a][t]=this[a][t]}else n[a]=this[a];return n}},U={version:"0.4"},V=[],F=[],Y=function(e,t){var o=t||new Date,s=null;if(x=A.set(e),M=n(x.container)){s="#"+x.container;var i=window.getComputedStyle(M,null);parseInt(i.width)||x.width||(M.style.width=a(window.innerWidth)),parseInt(i.height)||x.height||(M.style.height=a(window.innerHeight))}else s="body",M=document.body;H=M?M.clientWidth:window.innerWidth,O=M?M.clientHeight:window.innerHeight,w=d3.select(s).append("container"),P=new THREE.WebGLRenderer({antialias:!0}),P.setClearColor("#000"),P.setSize(H,O),P.setPixelRatio(window.devicePixelRatio),P.shadowMap.enabled=!0,P.shadowMap.type=THREE.BasicShadowMap,M.appendChild(P.domElement),R=new THREE.Scene,R.fog=new THREE.FogExp2(0,25e-5),T=new THREE.PerspectiveCamera(45,H/O,.01,1e4),T.position.z=3.5,T.position.y=2;new THREE.OrbitControls(T);R.add(new THREE.AmbientLight(3355443));var c=new THREE.PointLight(16777215,1,0);c.castShadow=!0;var l=b.Planets.create("sol");if(c.add(l),R.add(c),d3.json("data/planets.json",function(e,t){if(e)return console.log(e);var n=[];for(var a in t)if(r(t,a)){var s={id:a},i=z(o,t[a]);if(s.body=i,r(t[a],"trajectory")){var c=I(o,t[a]),l=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.VertexColors,transparent:!0,opacity:.6,fog:!0}),u=new THREE.Line(c,l);R.add(u),s.track=u}var d=b.Planets.create(a);d||(d=new THREE.Mesh(new THREE.SphereGeometry(.02,32,32),new THREE.MeshPhongMaterial({color:"#fff"}))),d.position.fromArray(i.pos),R.add(d),s.mesh=d,n.push(s)}w.selectAll(".planets").data(n).enter().append("path").attr("class","planet")}),d3.json("data/sbo.json",function(e,t){if(e)return console.log(e);for(var n=[],a=(new THREE.TextureLoader).load("maps/circle.png"),s=[],i=[],c=.006,l=1;12>=l;l++)s.push(new THREE.Geometry),i.push(new THREE.PointsMaterial({color:13408665,map:a,size:c*l,transparent:!0,fog:!0}));for(var u in t)if(r(t,u)){var d={},p=z(o,t[u]);d.body=p;var h=new THREE.Vector3;h.fromArray(p.pos);var m=Math.floor(p.r);m>12&&(m=12),s[m-1].vertices.push(h),d.size=m,d.vertex=s[m-1].vertices.length-1,n.push(d)}for(l=0;12>l;l++)V[l]=new THREE.Points(s[l],i[l]),R.add(V[l]);w.selectAll(".sbos").data(n).enter().append("path").attr("class","sbo")}),F.push(function(){var e=T.position;R.fog.density=.05/Math.pow(e.x*e.x+e.y*e.y+e.z*e.z,.5),
P.render(R,T)}),x.date===!0){var u=j({callback:function(e,t){o.setTime(e.valueOf()),d3.select("#datetime").html(u.date()),U.update(o)},target:"#datetime",time:!1,dateselect:!1,startofweek:1});d3.select(s).append("div").attr("id","datetime").html(u.date()).on("click",function(){u(o)})}g()},Z=function(e){w.selectAll(".planet").each(function(t){var n=D(e,t.body);n&&(t.body.pos=n,t.mesh.position.fromArray(n))}),w.selectAll(".sbo").each(function(t){var n=D(e,t.body);t.body.pos=n,V[t.size-1].geometry.vertices[t.vertex].fromArray(n)}),V.forEach(function(e){e.geometry.verticesNeedUpdate=!0})};window.addEventListener("resize",function(){var e=window.getComputedStyle(M,null);H=parseInt(e.width),O=parseInt(e.height),P.setSize(H,O),T.aspect=H/O,T.updateProjectionMatrix()},!1);var q=null;U.display=Y,U.update=Z,U.animate=function(e){Z(e),e.setDate(e.getDate()+1),setTimeout(U.animate,100,e)},this.Orrery=U}();