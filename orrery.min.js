// Copyright 2015 Olaf Frohn https://github.com/ofrohn, see LICENSE
!function(){function e(e){var n,a="hr"===e.id||"min"===e.id||"sec"===e.id?1:0;if(e.validity){if(n=e.validity,n.typeMismatch||n.badInput)return t(e,e.title+": check field value"),!1;if(n.rangeOverflow||n.rangeUnderflow)return t(e,e.title+" must be between "+(parseInt(e.min)+a)+" and "+(parseInt(e.max)-a)),!1}else{if(n=e.value,!o(n))return t(e,e.title+": check field value"),!1;if(n=parseFloat(n),n<e.min||n>e.max)return t(e,e.title+" must be between "+(e.min+a)+" and "+(+e.max-a)),!1}return d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),!0}function t(e,t){var n=i(e);d3.select("#error").html(t).style({top:a(n[1]+e.offsetHeight+1),left:a(n[0]),opacity:1}),e.focus()}function n(e){return document.getElementById(e)}function a(e){return e+"px"}function r(e,t){return null!==e&&hasOwnProperty.call(e,t)}function o(e){return!isNaN(parseFloat(e))&&isFinite(e)}function i(e){var t=0,n=0,a=e.offsetWidth,r=e.offsetHeight;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(null!==(e=e.offsetParent));return{l:t,t:n,w:a,h:r}}function s(e){if(e){var t=e.split(".");if(!(t.length<1)&&(t=t[0].split("-"),t[0]=t[0].replace(/\D/g,""),t[0]))return t[1]=t[1]?t[1].replace(/\D/g,""):"1",t[2]=t[2]?t[2].replace(/\D/g,""):"1",new Date(t[0],t[1]-1,t[2])}}function c(e,t,n){var a,r=e.valueOf();if(!t)return new Date(r);switch(a=n||"d"){case"y":case"yr":r+=31556926080*t;break;case"m":case"mo":r+=26298e5*t;break;case"d":case"dy":r+=864e5*t;break;case"h":case"hr":r+=36e5*t;break;case"n":case"mn":r+=6e4*t;break;case"s":case"sec":r+=1e3*t;break;case"ms":r+=t}return new Date(r)}function l(e,t,n){if(t&&e){var a=t.valueOf()-e.valueOf(),r=n||"d";switch(r){case"y":case"yr":a/=31556926080;break;case"m":case"mo":a/=26298e5;break;case"d":case"dy":a/=864e5;break;case"h":case"hr":a/=36e5;break;case"n":case"mn":a/=6e4;break;case"s":case"sec":a/=1e3;break;case"ms":}return n?Math.floor(a):a}}function u(e,t){for(var n=t>1?e*e:-e*e,a=t*n*e/6,r=(1-t)*e-a,o=4;Math.abs(a)>1e-15;)a*=n/(o*(o+1)),r-=a,o+=2;return r}function d(e){var t,n,a,r,o=e.e,i=e.M,s=1e-8,c=0,l=1.9,d=!1,p=0;if(!i)return 0;if(1>o&&((i<-Math.PI||i>Math.PI)&&(r=R.normalize0(i),c=i-r,i=r),.9>o)){t=Math.atan2(Math.sin(i),Math.cos(i)-o);do n=(t-o*Math.sin(t)-i)/(1-o*Math.cos(t)),t-=n;while(Math.abs(n)>s);return t}if(0>i&&(i=-i,d=!0),t=i,s*=Math.abs(1-o),1e-15>s&&(s=1e-15),(o>.8&&i<Math.PI/3||o>1)&&(a=i/Math.abs(1-o),a*a>6*Math.abs(1-o)&&(a=i<Math.PI?Math.pow(6*i,1/3):R.asinh(i/o)),t=a),o>1&&i>4&&(t=Math.log(i)),1>o)for(;Math.abs(l)>s;)n=p++>8?u(t,o)-i:t-o*Math.sin(t)-i,l=-n/(1-o*Math.cos(t)),t+=l;else for(;Math.abs(l)>s;)n=p++>7?-u(t,o)-i:o*R.sinh(t)-t-i,l=-n/(o*R.cosh(t)-1),t+=l;return d?c-t:c+t}function p(e){var t,n,a,r,o;1===e.e?(o=e.jd0-e.T,r=e.w0*o*.5,n=Math.pow(r+Math.sqrt(r*r+1),1/3),e.v=2*Math.atan(n-1/n)):(e.E=d(e),e.e>1?(t=e.e-R.cosh(e.E),n=R.sinh(e.E)):(t=Math.cos(e.E)-e.e,n=Math.sin(e.E)),n*=Math.sqrt(Math.abs(1-e.e*e.e)),e.v=Math.atan2(n,t)),a=e.q*(1+e.e),e.r=a/(1+e.e*Math.cos(e.v))}function h(e){e.hasOwnProperty("w")||(e.w=e.W-e.N),e.hasOwnProperty("M")||(e.M=e.L-e.W),e.e<1&&(e.M=R.normalize0(e.M)),e.P=Math.pow(Math.abs(e.a),1.5),e.T=e.jd0-e.M/Math.PI/2/e.P,1!==e.e?(e.q=e.a*(1-e.e),e.t0=e.a*Math.sqrt(Math.abs(e.a)/y)):(e.w0=3/Math.sqrt(2)/(e.q*Math.sqrt(e.q/y)),e.a=0,e.t0=0),e.am=Math.sqrt(y*e.q*(1+e.e))}function m(e){var t,n,a,r=e.v+e.w;return t=e.r*(Math.cos(e.N)*Math.cos(r)-Math.sin(e.N)*Math.sin(r)*Math.cos(e.i)),n=e.r*(Math.sin(e.N)*Math.cos(r)+Math.cos(e.N)*Math.sin(r)*Math.cos(e.i)),a=e.r*(Math.sin(r)*Math.sin(e.i)),e.x=t,e.y=n,e.z=a,{x:t,y:n,z:a}}function f(e){var t,n;return t=Math.atan2(e.y,e.x),n=Math.atan2(e.z,Math.sqrt(e.x*e.x+e.y*e.y)),e.l=R.normalize(t),e.b=n,{l:t,b:n}}function E(e){var t=e.getUTCFullYear(),n=e.getUTCMonth()+1,a=e.getUTCDate(),r=(e.getUTCHours()-12+e.getUTCMinutes()/60+e.getUTCSeconds()/3600)/24,o=-4799;if(o>t)return-1;var i=Math.floor((14-n)/12),s=t+4800-i,c=n+12*i-3,l=a+Math.floor((153*c+2)/5)+365*s+Math.floor(s/4)-Math.floor(s/100)+Math.floor(s/400)-32045;return l+r}function v(){requestAnimationFrame(function e(t){requestAnimationFrame(e),B=B||t-1e3/60;var n=Math.min(200,t-B);B=t,Z.forEach(function(e){e(n/1e3,t/1e3)})})}var g=g||{};g.Planets={},g.Planets.baseURL="images/maps/",g.Planets.params={sol:{map:"sunmap.jpg",radius:.12,tilt:7.25,rot:1.0438,corona:{map:"solarcorona.jpg",radius:.53}},mer:{map:"mercurymap.jpg",bump:"mercurybump.jpg",radius:.03,tilt:0,rot:58.646},ven:{map:"venusmap.jpg",radius:.04,tilt:177.3,rot:4.05},ter:{map:"earthmap.jpg",bump:"earthbump.jpg",clouds:"earthclouds.png",radius:.04,tilt:23.45,rot:.9973},lun:{map:"moonmap.jpg",bump:"moonbump.jpg",radius:.025,tilt:1.54,rot:27.3217},mar:{map:"marsmap.jpg",bump:"marsbump.jpg",clouds:"marsclouds.png",radius:.035,tilt:25.19,rot:1.026},ves:{map:"vestamap.jpg",bump:"vestabump.jpg",radius:.01,tilt:29,rot:.223},cer:{map:"ceresmap.jpg",radius:.016,tilt:4,rot:.378},jup:{map:"jupitermap.jpg",radius:.12,tilt:3.12,rot:.414,ring:{map:"jupiterrings.png",radius:.27,opacity:.5}},sat:{map:"saturnmap.jpg",radius:.12,tilt:26.73,rot:.444,ring:{map:"saturnrings.png",radius:.26,opacity:1}},ura:{map:"uranusmap.jpg",radius:.1,tilt:97.86,rot:.718,ring:{map:"uranusrings.png",radius:.2,opacity:.5}},nep:{map:"neptunemap.jpg",radius:.1,tilt:29.56,rot:.671,ring:{map:"neptunerings.png",radius:.25,opacity:.8}},plu:{map:"plutomap.jpg",radius:.02,tilt:122.53,rot:6.387}};var b={Sun:"sol",Mercury:"mer",Venus:"ven",Earth:"ter",Moon:"lun",Mars:"mar",Vesta:"ves",Ceres:"cer",Jupiter:"jup",Saturn:"sat",Uranus:"ura",Neptune:"nep",Pluto:"plu"};g.Planets.createSun=function(){return g.Planets.create("sun")},g.Planets.createMercury=function(){return g.Planets.create("mercury")},g.Planets.createVenus=function(){return g.Planets.create("venus")},g.Planets.createEarth=function(){return g.Planets.create("earth",!0)},g.Planets.createMoon=function(){return g.Planets.create("moon")},g.Planets.createMars=function(){return g.Planets.create("mars")},g.Planets.createJupiter=function(){return g.Planets.create("jupiter")},g.Planets.createJupiterRing=function(){return g.Planets.createRing("jupiter")},g.Planets.createSaturn=function(){return g.Planets.create("saturn",!0)},g.Planets.createSaturnRing=function(){return g.Planets.createRing("saturn")},g.Planets.createUranus=function(){return g.Planets.create("uranus",!0)},g.Planets.createUranusRing=function(){return g.Planets.createRing("uranus")},g.Planets.createNeptune=function(){return g.Planets.create("neptune")},g.Planets.createNeptuneRing=function(){return g.Planets.createRing("neptune")},g.Planets.createPluto=function(){return g.Planets.create("pluto")},g.Planets.createStarfield=function(){var e=new THREE.TextureLoader,t=e.load(g.Planets.baseURL+"tycho-skymap.jpg"),n=new THREE.MeshBasicMaterial({map:t,side:THREE.BackSide}),a=new THREE.SphereGeometry(100,32,32),r=new THREE.Mesh(a,n);return r},g.Planets.create=function(e,t){if(!g.Planets.params.hasOwnProperty(e)){if(!b.hasOwnProperty(e))return console.log("Object not found: "+e),null;e=b[e]}var n=g.Planets.params[e],a={},r=new THREE.TextureLoader,o=new THREE.SphereGeometry(n.radius,32,32);if(a.map=r.load(g.Planets.baseURL+n.map),n.hasOwnProperty("bump")&&(a.bumpMap=r.load(g.Planets.baseURL+n.bump),a.bumpScale=.001),n.hasOwnProperty("spec")&&(a.specularMap=r.load(g.Planets.baseURL+n.spec)),"sol"===e)var i=new THREE.MeshBasicMaterial(a);else{a.specular=new THREE.Color(3355443),a.shininess=.1;var i=new THREE.MeshPhongMaterial(a)}var s=new THREE.Mesh(o,i);if(!t&&n.hasOwnProperty("ring")){s.receiveShadow=!0,s.castShadow=!0;var c=g.Planets.createRings(e);c.receiveShadow=!0,c.castShadow=!0,s.add(c)}return!t&&n.hasOwnProperty("clouds")&&s.add(g.Planets.createClouds(e)),t||"sol"!==e||s.add(g.Planets.createCorona()),s.rotation.set(0,0,THREE.Math.degToRad(n.tilt)),s},g.Planets.createRings=function(e){if(!g.Planets.params.hasOwnProperty(e)){if(!b.hasOwnProperty(e))return console.log("Object not found: "+e),null;e=b[e]}if(!g.Planets.params[e].hasOwnProperty("ring"))return console.log("Rings not found: "+e),null;var t=g.Planets.params[e],n=g.Planets.baseURL+t.ring.map,a=new THREE.TextureLoader,r=new g.Planets.RingGeometry(1.05*t.radius,t.ring.radius,64,64),o=new THREE.MeshPhongMaterial({map:a.load(n),side:THREE.DoubleSide,transparent:!0,opacity:t.ring.opacity}),i=new THREE.Mesh(r,o);return i.lookAt(new THREE.Vector3(0,1,0)),i.name=e+"rings",i},g.Planets.createClouds=function(e){if(!g.Planets.params.hasOwnProperty(e)){if(!b.hasOwnProperty(e))return console.log("Object not found: "+e),null;e=b[e]}if(!g.Planets.params[e].hasOwnProperty("clouds"))return console.log("Clouds not found: "+e),null;var t=g.Planets.params[e],n=g.Planets.baseURL+t.clouds,a=new THREE.TextureLoader,r=new THREE.Mesh(new THREE.SphereGeometry(1.01*t.radius,32,32),new THREE.MeshPhongMaterial({map:a.load(n),transparent:!0}));return r.name=e+"clouds",r},g.Planets.createCorona=function(){var e=g.Planets.params.sol,t=g.Planets.baseURL+e.corona.map,n=new THREE.SpriteMaterial({map:(new THREE.TextureLoader).load(t),color:16777011,transparent:!1,blending:THREE.AdditiveBlending}),a=new THREE.Sprite(n);return a.scale.multiplyScalar(e.corona.radius),a.name="solcorona",a},g.Planets.RingGeometry=function(e,t,n,a,r,o){THREE.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:a,thetaStart:r,thetaLength:o},e=e||0,t=t||50,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8,a=void 0!==a?Math.max(1,a):8;var i,s,c=[],l=e,u=(t-e)/a;for(i=0;a+1>i;i++){for(s=0;n+1>s;s++){var d=new THREE.Vector3,p=r+s/n*o;d.x=l*Math.cos(p),d.y=l*Math.sin(p),this.vertices.push(d),c.push(new THREE.Vector2(i/(n-1),s/(a-1)))}l+=u}var h=new THREE.Vector3(0,0,1);for(i=0;a>i;i++){var m=i*(n+1);for(s=0;n>s;s++){var p=s+m,f=p,E=p+n+1,v=p+n+2;this.faces.push(new THREE.Face3(f,E,v,[h.clone(),h.clone(),h.clone()])),this.faceVertexUvs[0].push([c[f].clone(),c[E].clone(),c[v].clone()]),f=p,E=p+n+2,v=p+1,this.faces.push(new THREE.Face3(f,E,v,[h.clone(),h.clone(),h.clone()])),this.faceVertexUvs[0].push([c[f].clone(),c[E].clone(),c[v].clone()])}}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,l)},g.Planets.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),g.Planets.RingGeometry.prototype.constructor=g.Planets.RingGeometry,THREE.OrbitControls=function(e,t){function n(){return 2*Math.PI/60/60*z.autoRotateSpeed}function a(){return Math.pow(.95,z.zoomSpeed)}function r(e){Z-=e}function o(e){Y-=e}function i(e){z.object instanceof THREE.PerspectiveCamera?q/=e:z.object instanceof THREE.OrthographicCamera?(z.object.zoom=Math.max(z.minZoom,Math.min(z.maxZoom,z.object.zoom*e)),z.object.updateProjectionMatrix(),B=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),z.enableZoom=!1)}function s(e){z.object instanceof THREE.PerspectiveCamera?q*=e:z.object instanceof THREE.OrthographicCamera?(z.object.zoom=Math.max(z.minZoom,Math.min(z.maxZoom,z.object.zoom/e)),z.object.updateProjectionMatrix(),B=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),z.enableZoom=!1)}function c(e){W.set(e.clientX,e.clientY)}function l(e){$.set(e.clientX,e.clientY)}function u(e){K.set(e.clientX,e.clientY)}function d(e){X.set(e.clientX,e.clientY),_.subVectors(X,W);var t=z.domElement===document?z.domElement.body:z.domElement;r(2*Math.PI*_.x/t.clientWidth*z.rotateSpeed),o(2*Math.PI*_.y/t.clientHeight*z.rotateSpeed),W.copy(X),z.update()}function p(e){ee.set(e.clientX,e.clientY),te.subVectors(ee,$),te.y>0?i(a()):te.y<0&&s(a()),$.copy(ee),z.update()}function h(e){J.set(e.clientX,e.clientY),Q.subVectors(J,K),re(Q.x,Q.y),K.copy(J),z.update()}function m(e){}function f(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?s(a()):0>t&&i(a()),z.update()}function E(e){switch(e.keyCode){case z.keys.UP:re(0,z.keyPanSpeed),z.update();break;case z.keys.BOTTOM:re(0,-z.keyPanSpeed),z.update();break;case z.keys.LEFT:re(z.keyPanSpeed,0),z.update();break;case z.keys.RIGHT:re(-z.keyPanSpeed,0),z.update()}}function v(e){W.set(e.touches[0].pageX,e.touches[0].pageY)}function g(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);$.set(0,a)}function b(e){K.set(e.touches[0].pageX,e.touches[0].pageY)}function y(e){X.set(e.touches[0].pageX,e.touches[0].pageY),_.subVectors(X,W);var t=z.domElement===document?z.domElement.body:z.domElement;r(2*Math.PI*_.x/t.clientWidth*z.rotateSpeed),o(2*Math.PI*_.y/t.clientHeight*z.rotateSpeed),W.copy(X),z.update()}function w(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);ee.set(0,r),te.subVectors(ee,$),te.y>0?s(a()):te.y<0&&i(a()),$.copy(ee),z.update()}function M(e){J.set(e.touches[0].pageX,e.touches[0].pageY),Q.subVectors(J,K),re(Q.x,Q.y),K.copy(J),z.update()}function R(e){}function T(e){if(z.enabled!==!1){if(e.preventDefault(),e.button===z.mouseButtons.ORBIT){if(z.enableRotate===!1)return;c(e),V=U.ROTATE}else if(e.button===z.mouseButtons.ZOOM){if(z.enableZoom===!1)return;l(e),V=U.DOLLY}else if(e.button===z.mouseButtons.PAN){if(z.enablePan===!1)return;u(e),V=U.PAN}V!==U.NONE&&(document.addEventListener("mousemove",P,!1),document.addEventListener("mouseup",H,!1),document.addEventListener("mouseout",H,!1),z.dispatchEvent(I))}}function P(e){if(z.enabled!==!1)if(e.preventDefault(),V===U.ROTATE){if(z.enableRotate===!1)return;d(e)}else if(V===U.DOLLY){if(z.enableZoom===!1)return;p(e)}else if(V===U.PAN){if(z.enablePan===!1)return;h(e)}}function H(e){z.enabled!==!1&&(m(e),document.removeEventListener("mousemove",P,!1),document.removeEventListener("mouseup",H,!1),document.removeEventListener("mouseout",H,!1),z.dispatchEvent(N),V=U.NONE)}function x(e){z.enabled!==!1&&z.enableZoom!==!1&&V===U.NONE&&(e.preventDefault(),e.stopPropagation(),f(e),z.dispatchEvent(I),z.dispatchEvent(N))}function O(e){z.enabled!==!1&&z.enableKeys!==!1&&z.enablePan!==!1&&E(e)}function j(e){if(z.enabled!==!1){switch(e.touches.length){case 1:if(z.enableRotate===!1)return;v(e),V=U.TOUCH_ROTATE;break;case 2:if(z.enableZoom===!1)return;g(e),V=U.TOUCH_DOLLY;break;case 3:if(z.enablePan===!1)return;b(e),V=U.TOUCH_PAN;break;default:V=U.NONE}V!==U.NONE&&z.dispatchEvent(I)}}function C(e){if(z.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(z.enableRotate===!1)return;if(V!==U.TOUCH_ROTATE)return;y(e);break;case 2:if(z.enableZoom===!1)return;if(V!==U.TOUCH_DOLLY)return;w(e);break;case 3:if(z.enablePan===!1)return;if(V!==U.TOUCH_PAN)return;M(e);break;default:V=U.NONE}}function S(e){z.enabled!==!1&&(R(e),z.dispatchEvent(N),V=U.NONE)}function k(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return A},this.getAzimuthalAngle=function(){return L},this.reset=function(){z.target.copy(z.target0),z.object.position.copy(z.position0),z.object.zoom=z.zoom0,z.object.updateProjectionMatrix(),z.dispatchEvent(D),z.update(),V=U.NONE},this.update=function(){var t=new THREE.Vector3,a=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),o=a.clone().inverse(),i=new THREE.Vector3,s=new THREE.Quaternion;return function(){var e=z.object.position;t.copy(e).sub(z.target),t.applyQuaternion(a),L=Math.atan2(t.x,t.z),A=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y),z.autoRotate&&V===U.NONE&&r(n()),L+=Z,A+=Y,L=Math.max(z.minAzimuthAngle,Math.min(z.maxAzimuthAngle,L)),A=Math.max(z.minPolarAngle,Math.min(z.maxPolarAngle,A)),A=Math.max(F,Math.min(Math.PI-F,A));var c=t.length()*q;return c=Math.max(z.minDistance,Math.min(z.maxDistance,c)),z.target.add(G),t.x=c*Math.sin(A)*Math.sin(L),t.y=c*Math.cos(A),t.z=c*Math.sin(A)*Math.cos(L),t.applyQuaternion(o),e.copy(z.target).add(t),z.object.lookAt(z.target),z.enableDamping===!0?(Z*=1-z.dampingFactor,Y*=1-z.dampingFactor):(Z=0,Y=0),q=1,G.set(0,0,0),B||i.distanceToSquared(z.object.position)>F||8*(1-s.dot(z.object.quaternion))>F?(z.dispatchEvent(D),i.copy(z.object.position),s.copy(z.object.quaternion),B=!1,!0):!1}}(),this.dispose=function(){z.domElement.removeEventListener("contextmenu",k,!1),z.domElement.removeEventListener("mousedown",T,!1),z.domElement.removeEventListener("mousewheel",x,!1),z.domElement.removeEventListener("MozMousePixelScroll",x,!1),z.domElement.removeEventListener("touchstart",j,!1),z.domElement.removeEventListener("touchend",S,!1),z.domElement.removeEventListener("touchmove",C,!1),document.removeEventListener("mousemove",P,!1),document.removeEventListener("mouseup",H,!1),document.removeEventListener("mouseout",H,!1),window.removeEventListener("keydown",O,!1)};var L,A,z=this,D={type:"change"},I={type:"start"},N={type:"end"},U={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},V=U.NONE,F=1e-6,Y=0,Z=0,q=1,G=new THREE.Vector3,B=!1,W=new THREE.Vector2,X=new THREE.Vector2,_=new THREE.Vector2,K=new THREE.Vector2,J=new THREE.Vector2,Q=new THREE.Vector2,$=new THREE.Vector2,ee=new THREE.Vector2,te=new THREE.Vector2,ne=function(){var e=new THREE.Vector3;return function(t,n){var a=n.elements;e.set(a[0],a[1],a[2]),e.multiplyScalar(-t),G.add(e)}}(),ae=function(){var e=new THREE.Vector3;return function(t,n){var a=n.elements;e.set(a[4],a[5],a[6]),e.multiplyScalar(t),G.add(e)}}(),re=function(){var e=new THREE.Vector3;return function(t,n){var a=z.domElement===document?z.domElement.body:z.domElement;if(z.object instanceof THREE.PerspectiveCamera){var r=z.object.position;e.copy(r).sub(z.target);var o=e.length();o*=Math.tan(z.object.fov/2*Math.PI/180),ne(2*t*o/a.clientHeight,z.object.matrix),ae(2*n*o/a.clientHeight,z.object.matrix)}else z.object instanceof THREE.OrthographicCamera?(ne(t*(z.object.right-z.object.left)/a.clientWidth,z.object.matrix),ae(n*(z.object.top-z.object.bottom)/a.clientHeight,z.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),z.enablePan=!1)}}();z.domElement.addEventListener("contextmenu",k,!1),z.domElement.addEventListener("mousedown",T,!1),z.domElement.addEventListener("mousewheel",x,!1),z.domElement.addEventListener("MozMousePixelScroll",x,!1),z.domElement.addEventListener("touchstart",j,!1),z.domElement.addEventListener("touchend",S,!1),z.domElement.addEventListener("touchmove",C,!1),window.addEventListener("keydown",O,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.constraint.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.constraint.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor=e}}});var y,w=function(t){function n(e){var t=U.node(),n=d3.select(j).node(),r=s(t,n);-9999===t.offsetTop?(R.setTime(e.valueOf()),v(),U.style({top:a(r[1]),left:a(r[0]),opacity:1}),d3.select(n).classed("active",!0)):g()}function s(e,t){var n=i(t),a="left"===N[0]?n.l:n.l+n.w-e.offsetWidth,r="top"===N[1]?n.t-e.offsetHeight-1:n.t+n.h-1;return[a,r]}function c(){var e,t=d3.select("#cal"),n=d3.select("#mon").node().value,a=d3.select("#yr").node().value,r=new Date,i=z;t.node()||(t=U.append("div").attr("id","cal")),a=parseInt(a),n=o(n)?parseInt(n):y(n);var s=new Date(a,n,1);s.setDate(s.getDate()-s.getDay()+i);for(var c=t.node();c.firstChild;)c.removeChild(c.firstChild);if(L===!0)for(e=i;i+7>e;e++){var u=e>6?e-7:e;t.append("div").classed({date:!0,weekday:!0}).html(x[u])}for(e=0;42>e;e++){var d=s.getMonth(),p=s.getDay(),h=w(s);t.append("div").classed({date:!0,grey:d!==n,weekend:d===n&&(0===p||6===p),today:0===l(s,r,"d"),selected:0===l(s,R,"d")}).attr("id",h).on("click",b).html(s.getDate().toString()),s.setDate(s.getDate()+1)}}function u(){var e=R.getFullYear();if(A===!0){var t=U.append("select").attr("title","Year").attr("id","yr").on("change",c).on("keyup",c),n=0;t.selectAll("option").data(O).enter().append("option").text(function(t,a){return t===e&&(n=a),t.toString()}),t.property("selectedIndex",n)}else U.append("input").attr("type","text").attr("title","Year").attr("id","yr").attr("readonly","readonly").attr("value",e)}function d(){var e=R.getMonth();if(A===!0){var t=U.append("select").attr("title","Month").attr("id","mon").on("change",c).on("keyup",c),n=0;t.selectAll("option").data(H).enter().append("option").attr("value",function(t,a){return a===e&&(n=a),a}).text(function(e){return e}),t.property("selectedIndex",n)}else U.append("input").attr("type","text").attr("title","Month").attr("id","mon").attr("readonly","readonly").attr("value",H[e])}function p(e){U.append("div").attr("id",e).on("click",function(){var t=d3.select("#mon").node(),n=d3.select("#yr").node();if("select"===t.tagName.toLowerCase())"left"===e?0===t.selectedIndex?(t.selectedIndex=11,n.selectedIndex--):t.selectedIndex--:11===t.selectedIndex?(t.selectedIndex=0,n.selectedIndex++):t.selectedIndex++;else{var a=y(t.value),r=parseInt(n.value);"left"===e?0===a?(a=11,r--):a--:11===a?(a=0,r++):a++,t.value=H[a],n.value=r}c()})}function h(){S!==!1&&(U.append("input").attr("type","number").attr("id","hr").attr("title","Hours").attr("max","24").attr("min","-1").attr("step","1").attr("value",R.getHours()).on("change",function(){e(this)===!0&&b()}),U.append("input").attr("type","number").attr("id","min").attr("title","Minutes").attr("max","60").attr("min","-1").attr("step","1").attr("value",R.getMinutes()).on("change",function(){e(this)===!0&&b()}),U.append("input").attr("type","number").attr("id","sec").attr("title","Seconds").attr("max","60").attr("min","-1").attr("step","1").attr("value",R.getSeconds()).on("change",function(){e(this)===!0&&b()}),k===!0&&m())}function m(){var e=U.append("select").attr("title","Time zone offset from UTC").attr("id","tz").on("change",b),t=15;T=R.getTimezoneOffset(),e.selectAll("option").data(P).enter().append("option").attr("value",function(e,n){var a=Object.keys(e)[0];return e[a]===T&&(t=n),e[a]}).text(function(e){return Object.keys(e)[0]}),e.property("selectedIndex",t)}function f(e){for(var t=e.getFullYear(),n=[],a=t-10;t+10>=a;a++)n.push(a);return n}function E(e,t){var n=d3.select(e).node();if("select"===n.tagName.toLowerCase()){for(var a=0;a<n.childNodes.length;a++)if(n.childNodes[a].value==t){n.selectedIndex=a;break}}else"mon"===n.id?n.value=H[t]:n.value=t}function v(){E("#yr",R.getFullYear()),E("#mon",R.getMonth()),c(),S&&(d3.select("#hr").node().value=R.getHours(),d3.select("#min").node().value=R.getMinutes(),d3.select("#sec").node().value=R.getSeconds())}function g(){U.style("opacity",0),d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),d3.select(j).classed("active",!1),setTimeout(function(){U.style("top",a(-9999))},600)}function b(){if(this.id&&-1!==this.id.search(/^\d/)&&(R=w.parse(this.id)),S===!0){var e=d3.select("#hr").node().value,t=d3.select("#min").node().value,n=d3.select("#sec").node().value;T=d3.select("#tz").node().value,R.setHours(e,t,n)}v(),I&&I(R,T),D===!0&&g()}function y(e){for(var t=0;t<H.length;t++)if(H[t]===e)return t}var w,M=t||{},R=new Date,T=R.getTimezoneOffset(),P=(d3.time.format("%Z"),[{"−12:00":720},{"−11:00":660},{"−10:00":600},{"−09:30":570},{"−09:00":540},{"−08:00":480},{"−07:00":420},{"−06:00":360},{"−05:00":300},{"−04:30":270},{"−04:00":240},{"−03:30":210},{"−03:00":180},{"−02:00":120},{"−01:00":60},{"±00:00":0},{"+01:00":-60},{"+02:00":-120},{"+03:00":-180},{"+03:30":-210},{"+04:00":-240},{"+04:30":-270},{"+05:00":-300},{"+05:30":-330},{"+05:45":-345},{"+06:00":-360},{"+06:30":-390},{"+07:00":-420},{"+08:00":-480},{"+08:30":-510},{"+08:45":-525},{"+09:00":-540},{"+09:30":-570},{"+10:00":-600},{"+10:30":-630},{"+11:00":-660},{"+12:00":-720},{"+12:45":-765},{"+13:00":-780},{"+14:00":-840}]),H=["January","February","March","April","May","June","July","August","September","October","November","December"],x=["Su","M","Tu","W","Th","F","Sa"],O=f(R),j=M.target||"",C=M.id||"datetimepicker",S=r(M,"time")?M.time:!0,k=r(M,"timezone")?M.timezone:!0,L=r(M,"weekdays")?M.weekdays:!0,A=r(M,"dateselect")?M.dateselect:!0,z=r(M,"startofweek")?M.startofweek:0,D=r(M,"vanishonpick")?M.vanishobpick:!0,I=M.callback||null,N=M.position||["left","top"];w=M.format?d3.time.format(M.format):d3.time.format("%Y-%m-%d");var U=d3.select("body").append("div").attr("id",C);return p("left"),d(),u(),p("right"),c(),h(),this.show=function(e){},this.isVisible=function(){return-9999!==U.node().offsetTop},this.hide=function(){g()},n.target=function(e){return arguments.length?(j=0!==e.indexOf("#")?"#"+e:e,n):j},n.dateFormat=function(e){return arguments.length?(w=d3.time.format(e),n):w},n.callback=function(e){return arguments.length?(I=e,n):I},n.date=function(){return w(R)},n},M=Math.PI/180,R={sinh:function(e){return(Math.pow(Math.E,e)-Math.pow(Math.E,-e))/2},cosh:function(e){return(Math.pow(Math.E,e)+Math.pow(Math.E,-e))/2},tanh:function(e){return 2/(1+Math.exp(-2*e))-1},asinh:function(e){return Math.log(e+Math.sqrt(e*e+1))},acosh:function(e){return Math.log(e+Math.sqrt(e*e-1))},normalize0:function(e){return(e+3*Math.PI)%(2*Math.PI)-Math.PI},normalize:function(e){return(e+2*Math.PI)%(2*Math.PI)},cartesian:function(e){var t=e[0]*M,n=(90-e[1])*M,a=e[2];return[a*Math.sin(n)*Math.cos(t),a*Math.sin(n)*Math.sin(t),a*Math.cos(n)]},spherical:function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),n=Math.atan(e.y/e.x),a=Math.acos(e.z/t);return[n/M,a/M,t]}},T={sol:.0002959122082855911,mer:0x95955473dbc3,ven:0x89d9374048629,ter:0xa923c08a47948,lun:36599199229256,mar:319711652803400,cer:467549107200,ves:129071530155,jup:0xd2088431b2a1400,sat:0x3ee37dea29c61e0,ura:0x99ad2c257ccb88,nep:0xb54f909dc5b7b8,plu:7327611364884,eri:827117568e4},P=function(e,t,n){var a,o,i,c={},l=["a","e","i","w","M","L","W","N","n"];for(y=n?T[n]:T.sol,t&&(a=t instanceof Date?t:s(t)),a||(a=new Date),c.jd=E(a),a=s(e.ep),c.jd0=E(a),c.d=c.jd-c.jd0,c.cy=c.d/36525,o=0;o<l.length;o++)i=l[o],r(e,"d"+i)?c[i]=e[i]+e["d"+i]*c.cy:r(e,i)&&(c[i]=e[i]),r(c,i)&&(-1===i.search(/a|e/)?c[i]*=Math.PI/180:c[i]*=1);return r(c,"M")&&!r(c,"dM")&&r(c,"n")&&(c.M+=c.n*c.d),h(c),p(c),m(c),f(c),c},H=function(e,t,n){var a=O(e,t.elements);if(!r(t.elements[a],"d")){var o=t.elements[a],i=P(o,e,n),s={name:t.name,pos:[-i.y,i.z,-i.x],elements:t.elements};return t.H&&""!==t.H?s.r=13-t.H:t.r&&""!==t.r?s.r=t.r:s.r=20,t.icon&&""!==t.icon&&(s.icon=t.icon),s}},x=function(e,t){var n=O(e,t.elements);if(!r(t.elements[n],"d")){var a=P(t.elements[n],e);return t.pos=[-a.y,a.z,-a.x],t.pos}},O=function(e,t){var n=0;if(t.length>1)for(var a=0;a<t.length;a++)if(l(new Date(Date.parse(t[a].ep)),e)<=0){n=0===a?0:a-1;break}return n},j=function(e,t){for(var n,a,r=t.elements[0],o=P(r,e),i=new THREE.Geometry,s=o.P,u=c(e,s,"y"),d=l(e,u)/90,p=new Date(e.valueOf());l(p,u)>0;)a=P(r,p),i.vertices.push(new THREE.Vector3(-a.y,a.z,-a.x)),n=a.z>=0?11184810:6710886,i.colors.push(new THREE.Color(n)),p=c(p,d);return i},C=(new THREE.TextureLoader).load("images/ast.png");C.wrapS=THREE.RepeatWrapping,C.wrapT=THREE.RepeatWrapping;var S,k,L,A,z,D,I,N,U,V=new THREE.ShaderMaterial({uniforms:{color:{value:new THREE.Color(10066329)},texture:{value:C}},vertexShader:["attribute float size;","attribute vec3 ca;","varying vec3 vColor;","void main() {","vColor = ca;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_PointSize = size * ( 1.0 / -mvPosition.z );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 color;","uniform sampler2D texture;","varying vec3 vColor;","void main() {","vec4 color = vec4( color * vColor, 1.0 ) * texture2D( texture, gl_PointCoord );","gl_FragColor = color;","}"].join("\n"),transparent:!0}),F={width:0,height:0,date:!0,dateformat:"%Y-%m-%d",container:"orrery-map",datapath:"data/",imagepath:"images/",planets:{show:!0,image:!0,trajectory:!0,size:null},sbos:{show:!0,image:!1,text:!0,trajectory:!1,size:null},spacecraft:{show:!1,image:!1,text:!0,trajectory:!1,size:null},other:[],set:function(e){var t,n={};if(!e)return this;for(var a in this)if(r(this,a)&&"function"!=typeof this[a])if(r(e,a)&&null!==e[a])if(null===this[a]||this[a].constructor!=Object)n[a]=e[a];else{n[a]={};for(t in this[a])r(e[a],t)?n[a][t]=e[a][t]:n[a][t]=this[a][t]}else n[a]=this[a];return n}},Y={version:"0.4"},Z=[],q=function(e,t){var o=t||new Date,i=null;if(N=F.set(e),k=n(N.container)){i="#"+N.container;var s=window.getComputedStyle(k,null);parseInt(s.width)||N.width||(k.style.width=a(window.innerWidth)),parseInt(s.height)||N.height||(k.style.height=a(window.innerHeight))}else i="body",k=document.body;D=k?k.clientWidth:window.innerWidth,I=k?k.clientHeight:window.innerHeight,S=d3.select(i).append("container"),L=new THREE.WebGLRenderer({antialias:!0}),L.setClearColor("#000"),L.setSize(D,I),L.setPixelRatio(window.devicePixelRatio),L.shadowMap.enabled=!0,L.shadowMap.type=THREE.BasicShadowMap,k.appendChild(L.domElement),A=new THREE.Scene,A.fog=new THREE.FogExp2(0,25e-5),z=new THREE.PerspectiveCamera(45,D/I,.01,1e4),z.position.z=3.5,z.position.y=2;new THREE.OrbitControls(z);A.add(new THREE.AmbientLight(3355443));var c=new THREE.PointLight(16777215,1,0);c.castShadow=!0;var l=g.Planets.create("sol");if(c.add(l),A.add(c),d3.json("data/planets.json",function(e,t){if(e)return console.log(e);var n=[];for(var a in t)if(r(t,a)){var i={id:a},s=H(o,t[a]);if(i.body=s,r(t[a],"trajectory")){var c=j(o,t[a]),l=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.VertexColors,transparent:!0,opacity:.6,fog:!0}),u=new THREE.Line(c,l);A.add(u),i.track=u}var d=g.Planets.create(a);d||(d=new THREE.Mesh(new THREE.SphereGeometry(.02,32,32),new THREE.MeshPhongMaterial({color:"#fff"}))),d.position.fromArray(s.pos),
A.add(d),i.mesh=d,n.push(i)}S.selectAll(".planets").data(n).enter().append("path").attr("class","planet").attr("id",function(e){return e.id})}),d3.json("data/sbo.json",function(e,t){if(e)return console.log(e);var n=[],a=Object.keys(t).length,i=new Float32Array(3*a),s=new Float32Array(3*a),c=new Float32Array(a),l=0;for(var u in t)if(r(t,u)){var d={id:u},p=H(o,t[u]);d.body=p;var h=(new THREE.Vector3).fromArray(p.pos);h.toArray(i,3*l);var m=new THREE.Color(15323569);m.toArray(s,3*l),c[l]=p.r,l++,n.push(d)}var f=new THREE.BufferGeometry;f.addAttribute("position",new THREE.BufferAttribute(i,3)),f.addAttribute("size",new THREE.BufferAttribute(c,1)),f.addAttribute("ca",new THREE.BufferAttribute(s,3)),U=new THREE.Points(f,V),A.add(U),S.selectAll(".sbos").data(n).enter().append("path").attr("class","sbo").attr("id",function(e){return e.id})}),Z.push(function(){var e=z.position;A.fog.density=.05/Math.pow(e.x*e.x+e.y*e.y+e.z*e.z,.5),L.render(A,z)}),N.date===!0){var u=w({callback:function(e,t){o.setTime(e.valueOf()),d3.select("#datetime").html(u.date()),Y.update(o)},target:"#datetime",time:!1,dateselect:!1,startofweek:0});d3.select(i).append("div").attr("id","datetime").html(u.date()).on("click",function(){u(o)})}v()},G=function(e){S.selectAll(".planet").each(function(t){var n=x(e,t.body);n&&(t.body.pos=n,t.mesh.position.fromArray(n))});var t=U.geometry.getAttribute("position").array;S.selectAll(".sbo").each(function(n,a){var r=x(e,n.body),o=(new THREE.Vector3).fromArray(r);o.toArray(t,3*a)}),U.geometry.attributes.position.needsUpdate=!0};window.addEventListener("resize",function(){var e=window.getComputedStyle(k,null);D=parseInt(e.width),I=parseInt(e.height),L.setSize(D,I),z.aspect=D/I,z.updateProjectionMatrix()},!1);var B=null;Y.display=q,Y.update=G,Y.animate=function(e){G(e),e.setDate(e.getDate()+1),setTimeout(Y.animate,100,e)},this.Orrery=Y}();