// Copyright 2015 Olaf Frohn https://github.com/ofrohn, see LICENSE
!function(){function e(e){return document.getElementById(e)}function t(e){return e+"px"}function n(e,t){return null!==e&&hasOwnProperty.call(e,t)}function a(e){if(e){var t=e.split(".");if(!(t.length<1)&&(t=t[0].split("-"),t[0]=t[0].replace(/\D/g,""),t[0]))return t[1]=t[1]?t[1].replace(/\D/g,""):"1",t[2]=t[2]?t[2].replace(/\D/g,""):"1",new Date(t[0],t[1]-1,t[2])}}function o(e,t,n){var a,o=e.valueOf();if(!t)return new Date(o);switch(a=n||"d"){case"y":case"yr":o+=31556926080*t;break;case"m":case"mo":o+=26298e5*t;break;case"d":case"dy":o+=864e5*t;break;case"h":case"hr":o+=36e5*t;break;case"n":case"mn":o+=6e4*t;break;case"s":case"sec":o+=1e3*t;break;case"ms":o+=t}return new Date(o)}function r(e,t,n){var a,o;if(t&&e){switch(a=t.valueOf()-e.valueOf(),o=n||"d"){case"y":case"yr":a/=31556926080;break;case"m":case"mo":a/=26298e5;break;case"d":case"dy":a/=864e5;break;case"h":case"hr":a/=36e5;break;case"n":case"mn":a/=6e4;break;case"s":case"sec":a/=1e3;break;case"ms":}return a}}function s(e){return(e.getHours()+e.getTimezoneOffset()/60+e.getMinutes()/60+e.getSeconds()/3600)/24}function i(e,t){for(var n=t>1?e*e:-e*e,a=t*n*e/6,o=(1-t)*e-a,r=4;Math.abs(a)>1e-15;)a*=n/(r*(r+1)),o-=a,r+=2;return o}function c(e){var t,n,a,o,r=e.e,s=e.M,c=1e-8,u=0,l=1.9,h=!1,p=0;if(!s)return 0;if(1>r&&((s<-Math.PI||s>Math.PI)&&(o=P.normalize0(s),u=s-o,s=o),.9>r)){t=Math.atan2(Math.sin(s),Math.cos(s)-r);do n=(t-r*Math.sin(t)-s)/(1-r*Math.cos(t)),t-=n;while(Math.abs(n)>c);return t}if(0>s&&(s=-s,h=!0),t=s,c*=Math.abs(1-r),1e-15>c&&(c=1e-15),(r>.8&&s<Math.PI/3||r>1)&&(a=s/Math.abs(1-r),a*a>6*Math.abs(1-r)&&(a=s<Math.PI?Math.pow(6*s,1/3):P.asinh(s/r)),t=a),r>1&&s>4&&(t=Math.log(s)),1>r)for(;Math.abs(l)>c;)n=p++>8?i(t,r)-s:t-r*Math.sin(t)-s,l=-n/(1-r*Math.cos(t)),t+=l;else for(;Math.abs(l)>c;)n=p++>7?-i(t,r)-s:r*P.sinh(t)-t-s,l=-n/(r*P.cosh(t)-1),t+=l;return h?u-t:u+t}function u(e){var t,n,a,o,r;1===e.e?(r=e.jd0-e.T,o=e.w0*r*.5,n=Math.pow(o+Math.sqrt(o*o+1),1/3),e.v=2*Math.atan(n-1/n)):(e.E=c(e),e.e>1?(t=e.e-P.cosh(e.E),n=P.sinh(e.E)):(t=Math.cos(e.E)-e.e,n=Math.sin(e.E)),n*=Math.sqrt(Math.abs(1-e.e*e.e)),e.v=Math.atan2(n,t)),a=e.q*(1+e.e),e.r=a/(1+e.e*Math.cos(e.v))}function l(e){e.hasOwnProperty("w")||(e.w=e.W-e.N),e.hasOwnProperty("M")||(e.M=e.L-e.W),e.e<1&&(e.M=P.normalize0(e.M)),e.P=Math.pow(Math.abs(e.a),1.5),e.T=e.jd0-e.M/Math.PI/2/e.P,1!==e.e?(e.q=e.a*(1-e.e),e.t0=e.a*Math.sqrt(Math.abs(e.a)/H)):(e.w0=3/Math.sqrt(2)/(e.q*Math.sqrt(e.q/H)),e.a=0,e.t0=0),e.am=Math.sqrt(H*e.q*(1+e.e))}function h(e){var t,n,a,o=e.v+e.w;return t=e.r*(Math.cos(e.N)*Math.cos(o)-Math.sin(e.N)*Math.sin(o)*Math.cos(e.i)),n=e.r*(Math.sin(e.N)*Math.cos(o)+Math.cos(e.N)*Math.sin(o)*Math.cos(e.i)),a=e.r*(Math.sin(o)*Math.sin(e.i)),e.x=t,e.y=n,e.z=a,{x:t,y:n,z:a}}function p(e){var t,n;return t=Math.atan2(e.y,e.x),n=Math.atan2(e.z,Math.sqrt(e.x*e.x+e.y*e.y)),e.l=P.normalize(t),e.b=n,{l:t,b:n}}function m(e){var t,n,a,o=e.getUTCFullYear(),r=e.getUTCMonth()+1,i=e.getUTCDate(),c=s(e),u=0,l=0,h=2400000.5,p=-4799,m=[31,28,31,30,31,30,31,31,30,31,30,31];return p>o?-1:1>r||r>12?-2:(2!==r||o%4!==0||o%100===0&&o%400!==0||(l=1),(1>i||i>m[r-1]+l)&&(u=-3),t=(r-14)/12,n=o+t,a=1461*(n+4800)/4+367*(r-2-12*t)/12-3*((n+4900)/100)/4+i-2432076,a+h+c)}function d(){requestAnimationFrame(function e(t){requestAnimationFrame(e),k=k||t-1e3/60;var n=Math.min(200,t-k);k=t,z.forEach(function(e){e(n/1e3,t/1e3)})})}var E=E||{};E.Planets={},E.Planets.baseURL="maps/",E.Planets.params={sol:{map:"sunmap.jpg",radius:.12,tilt:7.25,rot:1.0438,corona:{map:"solarcorona.jpg",radius:.53}},mer:{map:"mercurymap.jpg",bump:"mercurybump.jpg",radius:.03,tilt:0,rot:58.646},ven:{map:"venusmap.jpg",radius:.04,tilt:177.3,rot:4.05},ter:{map:"earthmap.jpg",bump:"earthbump.jpg",clouds:"earthclouds.png",radius:.04,tilt:23.45,rot:.9973},lun:{map:"moonmap.jpg",bump:"moonbump.jpg",radius:.025,tilt:1.54,rot:27.3217},mar:{map:"marsmap.jpg",bump:"marsbump.jpg",clouds:"marsclouds.png",radius:.035,tilt:25.19,rot:1.026},ves:{map:"vestamap.jpg",bump:"vestabump.jpg",radius:.01,tilt:29,rot:.223},cer:{map:"ceresmap.jpg",radius:.016,tilt:4,rot:.378},jup:{map:"jupitermap.jpg",radius:.12,tilt:3.12,rot:.414,ring:{map:"jupiterrings.png",radius:.27,opacity:.5}},sat:{map:"saturnmap.jpg",radius:.12,tilt:26.73,rot:.444,ring:{map:"saturnrings.png",radius:.26,opacity:1}},ura:{map:"uranusmap.jpg",radius:.1,tilt:97.86,rot:.718,ring:{map:"uranusrings.png",radius:.2,opacity:.5}},nep:{map:"neptunemap.jpg",radius:.1,tilt:29.56,rot:.671,ring:{map:"neptunerings.png",radius:.25,opacity:.8}},plu:{map:"plutomap.jpg",radius:.02,tilt:122.53,rot:6.387}},E.Planets.createSun=function(){return E.Planets.create("sun")},E.Planets.createMercury=function(){return E.Planets.create("mercury")},E.Planets.createVenus=function(){return E.Planets.create("venus")},E.Planets.createEarth=function(){return E.Planets.create("earth",!0)},E.Planets.createMoon=function(){return E.Planets.create("moon")},E.Planets.createMars=function(){return E.Planets.create("mars")},E.Planets.createJupiter=function(){return E.Planets.create("jupiter")},E.Planets.createJupiterRing=function(){return E.Planets.createRing("jupiter")},E.Planets.createSaturn=function(){return E.Planets.create("saturn",!0)},E.Planets.createSaturnRing=function(){return E.Planets.createRing("saturn")},E.Planets.createUranus=function(){return E.Planets.create("uranus",!0)},E.Planets.createUranusRing=function(){return E.Planets.createRing("uranus")},E.Planets.createNeptune=function(){return E.Planets.create("neptune")},E.Planets.createNeptuneRing=function(){return E.Planets.createRing("neptune")},E.Planets.createPluto=function(){return E.Planets.create("pluto")},E.Planets.createStarfield=function(){var e=new THREE.TextureLoader,t=e.load(E.Planets.baseURL+"tycho-skymap.jpg"),n=new THREE.MeshBasicMaterial({map:t,side:THREE.BackSide}),a=new THREE.SphereGeometry(100,32,32),o=new THREE.Mesh(a,n);return o},E.Planets.create=function(e,t){if(!E.Planets.params.hasOwnProperty(e))return console.log("Object not found: "+e),null;var n=E.Planets.params[e],a={},o=new THREE.TextureLoader,r=new THREE.SphereGeometry(n.radius,32,32);a.map=o.load(E.Planets.baseURL+n.map),n.hasOwnProperty("bump")&&(a.bumpMap=o.load(E.Planets.baseURL+n.bump),a.bumpScale=.02),n.hasOwnProperty("spec")&&(a.specularMap=o.load(E.Planets.baseURL+n.spec),a.specular=new THREE.Color("#333"));var s=new THREE.MeshPhongMaterial(a),i=new THREE.Mesh(r,s);if(!t&&n.hasOwnProperty("ring")){i.receiveShadow=!0,i.castShadow=!0;var c=E.Planets.createRings(e);c.receiveShadow=!0,c.castShadow=!0,i.add(c)}return!t&&n.hasOwnProperty("clouds")&&i.add(E.Planets.createClouds(e)),t||"sol"!==e||i.add(E.Planets.createCorona()),i.rotation.set(THREE.Math.degToRad(25),0,THREE.Math.degToRad(n.tilt)),i},E.Planets.createRings=function(e){var t=E.Planets.params[e],n=E.Planets.baseURL+t.ring.map,a=new THREE.TextureLoader,o=new E.Planets.RingGeometry(t.radius+.005,t.ring.radius,64,64),r=new THREE.MeshPhongMaterial({map:a.load(n),side:THREE.DoubleSide,transparent:!0,opacity:t.ring.opacity}),s=new THREE.Mesh(o,r);return s.lookAt(new THREE.Vector3(0,1,0)),s.name=e+"rings",s},E.Planets.createClouds=function(e){var t=E.Planets.params[e],n=E.Planets.baseURL+t.clouds,a=new THREE.TextureLoader,o=new THREE.Mesh(new THREE.SphereGeometry(t.radius+.005,32,32),new THREE.MeshPhongMaterial({map:a.load(n),transparent:!0}));return o.name=e+"clouds",o},E.Planets.createCorona=function(){var e=E.Planets.params.sol,t=E.Planets.baseURL+e.corona.map,n=new THREE.SpriteMaterial({map:(new THREE.TextureLoader).load(t),color:16777011,transparent:!1,blending:THREE.AdditiveBlending}),a=new THREE.Sprite(n);return a.scale.multiplyScalar(e.corona.radius),a.name="solcorona",a},E.Planets.RingGeometry=function(e,t,n,a,o,r){THREE.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:a,thetaStart:o,thetaLength:r},e=e||0,t=t||50,o=void 0!==o?o:0,r=void 0!==r?r:2*Math.PI,n=void 0!==n?Math.max(3,n):8,a=void 0!==a?Math.max(1,a):8;var s,i,c=[],u=e,l=(t-e)/a;for(s=0;a+1>s;s++){for(i=0;n+1>i;i++){var h=new THREE.Vector3,p=o+i/n*r;h.x=u*Math.cos(p),h.y=u*Math.sin(p),this.vertices.push(h),c.push(new THREE.Vector2(s/(n-1),i/(a-1)))}u+=l}var m=new THREE.Vector3(0,0,1);for(s=0;a>s;s++){var d=s*(n+1);for(i=0;n>i;i++){var p=i+d,E=p,f=p+n+1,b=p+n+2;this.faces.push(new THREE.Face3(E,f,b,[m.clone(),m.clone(),m.clone()])),this.faceVertexUvs[0].push([c[E].clone(),c[f].clone(),c[b].clone()]),E=p,f=p+n+2,b=p+1,this.faces.push(new THREE.Face3(E,f,b,[m.clone(),m.clone(),m.clone()])),this.faceVertexUvs[0].push([c[E].clone(),c[f].clone(),c[b].clone()])}}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,u)},E.Planets.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),E.Planets.RingGeometry.prototype.constructor=E.Planets.RingGeometry,THREE.OrbitControls=function(e,t){function n(){return 2*Math.PI/60/60*k.autoRotateSpeed}function a(){return Math.pow(.95,k.zoomSpeed)}function o(e){F-=e}function r(e){Z-=e}function s(e){k.object instanceof THREE.PerspectiveCamera?G/=e:k.object instanceof THREE.OrthographicCamera?(k.object.zoom=Math.max(k.minZoom,Math.min(k.maxZoom,k.object.zoom*e)),k.object.updateProjectionMatrix(),B=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),k.enableZoom=!1)}function i(e){k.object instanceof THREE.PerspectiveCamera?G*=e:k.object instanceof THREE.OrthographicCamera?(k.object.zoom=Math.max(k.minZoom,Math.min(k.maxZoom,k.object.zoom/e)),k.object.updateProjectionMatrix(),B=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),k.enableZoom=!1)}function c(e){X.set(e.clientX,e.clientY)}function u(e){$.set(e.clientX,e.clientY)}function l(e){_.set(e.clientX,e.clientY)}function h(e){W.set(e.clientX,e.clientY),K.subVectors(W,X);var t=k.domElement===document?k.domElement.body:k.domElement;o(2*Math.PI*K.x/t.clientWidth*k.rotateSpeed),r(2*Math.PI*K.y/t.clientHeight*k.rotateSpeed),X.copy(W),k.update()}function p(e){ee.set(e.clientX,e.clientY),te.subVectors(ee,$),te.y>0?s(a()):te.y<0&&i(a()),$.copy(ee),k.update()}function m(e){Q.set(e.clientX,e.clientY),J.subVectors(Q,_),oe(J.x,J.y),_.copy(Q),k.update()}function d(e){}function E(e){var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?i(a()):0>t&&s(a()),k.update()}function f(e){switch(e.keyCode){case k.keys.UP:oe(0,k.keyPanSpeed),k.update();break;case k.keys.BOTTOM:oe(0,-k.keyPanSpeed),k.update();break;case k.keys.LEFT:oe(k.keyPanSpeed,0),k.update();break;case k.keys.RIGHT:oe(-k.keyPanSpeed,0),k.update()}}function b(e){X.set(e.touches[0].pageX,e.touches[0].pageY)}function g(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);$.set(0,a)}function M(e){_.set(e.touches[0].pageX,e.touches[0].pageY)}function v(e){W.set(e.touches[0].pageX,e.touches[0].pageY),K.subVectors(W,X);var t=k.domElement===document?k.domElement.body:k.domElement;o(2*Math.PI*K.x/t.clientWidth*k.rotateSpeed),r(2*Math.PI*K.y/t.clientHeight*k.rotateSpeed),X.copy(W),k.update()}function R(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);ee.set(0,o),te.subVectors(ee,$),te.y>0?i(a()):te.y<0&&s(a()),$.copy(ee),k.update()}function w(e){Q.set(e.touches[0].pageX,e.touches[0].pageY),J.subVectors(Q,_),oe(J.x,J.y),_.copy(Q),k.update()}function T(e){}function y(e){if(k.enabled!==!1){if(e.preventDefault(),e.button===k.mouseButtons.ORBIT){if(k.enableRotate===!1)return;c(e),I=V.ROTATE}else if(e.button===k.mouseButtons.ZOOM){if(k.enableZoom===!1)return;u(e),I=V.DOLLY}else if(e.button===k.mouseButtons.PAN){if(k.enablePan===!1)return;l(e),I=V.PAN}I!==V.NONE&&(document.addEventListener("mousemove",P,!1),document.addEventListener("mouseup",H,!1),document.addEventListener("mouseout",H,!1),k.dispatchEvent(U))}}function P(e){if(k.enabled!==!1)if(e.preventDefault(),I===V.ROTATE){if(k.enableRotate===!1)return;h(e)}else if(I===V.DOLLY){if(k.enableZoom===!1)return;p(e)}else if(I===V.PAN){if(k.enablePan===!1)return;m(e)}}function H(e){k.enabled!==!1&&(d(e),document.removeEventListener("mousemove",P,!1),document.removeEventListener("mouseup",H,!1),document.removeEventListener("mouseout",H,!1),k.dispatchEvent(A),I=V.NONE)}function O(e){k.enabled!==!1&&k.enableZoom!==!1&&I===V.NONE&&(e.preventDefault(),e.stopPropagation(),E(e),k.dispatchEvent(U),k.dispatchEvent(A))}function j(e){k.enabled!==!1&&k.enableKeys!==!1&&k.enablePan!==!1&&f(e)}function x(e){if(k.enabled!==!1){switch(e.touches.length){case 1:if(k.enableRotate===!1)return;b(e),I=V.TOUCH_ROTATE;break;case 2:if(k.enableZoom===!1)return;g(e),I=V.TOUCH_DOLLY;break;case 3:if(k.enablePan===!1)return;M(e),I=V.TOUCH_PAN;break;default:I=V.NONE}I!==V.NONE&&k.dispatchEvent(U)}}function L(e){if(k.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(k.enableRotate===!1)return;if(I!==V.TOUCH_ROTATE)return;v(e);break;case 2:if(k.enableZoom===!1)return;if(I!==V.TOUCH_DOLLY)return;R(e);break;case 3:if(k.enablePan===!1)return;if(I!==V.TOUCH_PAN)return;w(e);break;default:I=V.NONE}}function C(e){k.enabled!==!1&&(T(e),k.dispatchEvent(A),I=V.NONE)}function S(e){e.preventDefault()}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return N},this.getAzimuthalAngle=function(){return z},this.reset=function(){k.target.copy(k.target0),k.object.position.copy(k.position0),k.object.zoom=k.zoom0,k.object.updateProjectionMatrix(),k.dispatchEvent(D),k.update(),I=V.NONE},this.update=function(){var t=new THREE.Vector3,a=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),r=a.clone().inverse(),s=new THREE.Vector3,i=new THREE.Quaternion;return function(){var e=k.object.position;t.copy(e).sub(k.target),t.applyQuaternion(a),z=Math.atan2(t.x,t.z),N=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y),k.autoRotate&&I===V.NONE&&o(n()),z+=F,N+=Z,z=Math.max(k.minAzimuthAngle,Math.min(k.maxAzimuthAngle,z)),N=Math.max(k.minPolarAngle,Math.min(k.maxPolarAngle,N)),N=Math.max(q,Math.min(Math.PI-q,N));var c=t.length()*G;return c=Math.max(k.minDistance,Math.min(k.maxDistance,c)),k.target.add(Y),t.x=c*Math.sin(N)*Math.sin(z),t.y=c*Math.cos(N),t.z=c*Math.sin(N)*Math.cos(z),t.applyQuaternion(r),e.copy(k.target).add(t),k.object.lookAt(k.target),k.enableDamping===!0?(F*=1-k.dampingFactor,Z*=1-k.dampingFactor):(F=0,Z=0),G=1,Y.set(0,0,0),B||s.distanceToSquared(k.object.position)>q||8*(1-i.dot(k.object.quaternion))>q?(k.dispatchEvent(D),s.copy(k.object.position),i.copy(k.object.quaternion),B=!1,!0):!1}}(),this.dispose=function(){k.domElement.removeEventListener("contextmenu",S,!1),k.domElement.removeEventListener("mousedown",y,!1),k.domElement.removeEventListener("mousewheel",O,!1),k.domElement.removeEventListener("MozMousePixelScroll",O,!1),k.domElement.removeEventListener("touchstart",x,!1),k.domElement.removeEventListener("touchend",C,!1),k.domElement.removeEventListener("touchmove",L,!1),document.removeEventListener("mousemove",P,!1),document.removeEventListener("mouseup",H,!1),document.removeEventListener("mouseout",H,!1),window.removeEventListener("keydown",j,!1)};var z,N,k=this,D={type:"change"},U={type:"start"},A={type:"end"},V={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},I=V.NONE,q=1e-6,Z=0,F=0,G=1,Y=new THREE.Vector3,B=!1,X=new THREE.Vector2,W=new THREE.Vector2,K=new THREE.Vector2,_=new THREE.Vector2,Q=new THREE.Vector2,J=new THREE.Vector2,$=new THREE.Vector2,ee=new THREE.Vector2,te=new THREE.Vector2,ne=function(){var e=new THREE.Vector3;return function(t,n){var a=n.elements;e.set(a[0],a[1],a[2]),e.multiplyScalar(-t),Y.add(e)}}(),ae=function(){var e=new THREE.Vector3;return function(t,n){var a=n.elements;e.set(a[4],a[5],a[6]),e.multiplyScalar(t),Y.add(e)}}(),oe=function(){var e=new THREE.Vector3;return function(t,n){var a=k.domElement===document?k.domElement.body:k.domElement;if(k.object instanceof THREE.PerspectiveCamera){var o=k.object.position;e.copy(o).sub(k.target);var r=e.length();r*=Math.tan(k.object.fov/2*Math.PI/180),ne(2*t*r/a.clientHeight,k.object.matrix),ae(2*n*r/a.clientHeight,k.object.matrix)}else k.object instanceof THREE.OrthographicCamera?(ne(t*(k.object.right-k.object.left)/a.clientWidth,k.object.matrix),ae(n*(k.object.top-k.object.bottom)/a.clientHeight,k.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),k.enablePan=!1)}}();k.domElement.addEventListener("contextmenu",S,!1),k.domElement.addEventListener("mousedown",y,!1),k.domElement.addEventListener("mousewheel",O,!1),k.domElement.addEventListener("MozMousePixelScroll",O,!1),k.domElement.addEventListener("touchstart",x,!1),k.domElement.addEventListener("touchend",C,!1),k.domElement.addEventListener("touchmove",L,!1),window.addEventListener("keydown",j,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.constraint.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.constraint.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor=e}}});var f,b,g,M,v,R,w,T,y=Math.PI/180,P={sinh:function(e){return(Math.pow(Math.E,e)-Math.pow(Math.E,-e))/2},cosh:function(e){return(Math.pow(Math.E,e)+Math.pow(Math.E,-e))/2},tanh:function(e){return 2/(1+Math.exp(-2*e))-1},asinh:function(e){return Math.log(e+Math.sqrt(e*e+1))},acosh:function(e){return Math.log(e+Math.sqrt(e*e-1))},normalize0:function(e){return(e+3*Math.PI)%(2*Math.PI)-Math.PI},normalize:function(e){return(e+2*Math.PI)%(2*Math.PI)},cartesian:function(e){var t=e[0]*y,n=e[1]*y,a=e[2];return[a*Math.sin(n)*Math.cos(t),a*Math.sin(n)*Math.sin(t),a*Math.cos(n)]},spherical:function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),n=Math.atan(e.y/e.x),a=Math.acos(e.z/t);return[n/y,a/y,t]}},H=Math.pow(.01720209895,2),O=function(e,t,o){var r,s,i,c={},d=["a","e","i","w","M","L","W","N","n"];for(o&&(H=o),t&&(r=t instanceof Date?t:a(t)),r||(r=new Date),c.jd=m(r),r=a(e.ep),c.jd0=m(r),c.d=c.jd-c.jd0,c.cy=c.d/36525,s=0;s<d.length;s++)i=d[s],n(e,"d"+i)?c[i]=e[i]+e["d"+i]*c.cy:n(e,i)&&(c[i]=e[i]),n(c,i)&&(-1===i.search(/a|e/)?c[i]*=Math.PI/180:c[i]*=1);return n(c,"M")&&!n(c,"dM")&&n(c,"n")&&(c.M+=c.n*c.d),l(c),u(c),h(c),p(c),c},j=function(e,t){var a=x(e,t.elements);if(!n(t.elements[a],"d")){var o=t.elements[a],r=O(o,e),s={name:t.name,pos:[-r.y,r.z,-r.x],elements:t.elements};return t.H&&""!==t.H?s.r=13-t.H:t.r&&""!==t.r?s.r=t.r:s.r=20,t.icon&&""!==t.icon&&(s.icon=t.icon),s}},x=function(e,t){var n=0;if(t.length>1)for(var a=0;a<t.length;a++)if(r(new Date(Date.parse(t[a].ep)),e)<=0){n=0===a?0:a-1;break}return n},L=function(e,t){for(var n,a,s=t.elements[0],i=O(s,e),c=new THREE.Geometry,u=i.P,l=o(e,u,"y"),h=r(e,l)/90,p=new Date(e.valueOf());r(p,l)>0;)a=O(s,p),c.vertices.push(new THREE.Vector3(-a.y,a.z,-a.x)),n=a.z>=0?10066329:6710886,c.colors.push(new THREE.Color(n)),p=o(p,h);return c},C={width:0,height:0,container:"map",datapath:"data/",imagepath:"img/",planets:{show:!0,image:!0,trajectory:!0,size:null},sbos:{show:!0,image:!1,text:!0,trajectory:!1,size:null},spacecraft:{show:!1,image:!1,text:!0,trajectory:!1,size:null},other:[],set:function(e){var t,a={};if(!e)return this;for(var o in this)if(n(this,o)&&"function"!=typeof this[o])if(n(e,o)&&null!==e[o])if(null===this[o]||this[o].constructor!=Object)a[o]=e[o];else{a[o]={};for(t in this[o])n(e[o],t)?a[o][t]=e[o][t]:a[o][t]=this[o][t]}else a[o]=this[o];return a}},S={version:"0.4"},z=[],N=function(a,o){var r=o||new Date,s=null;if(T=C.set(a),b=e(T.container)){s="#"+T.container;var i=window.getComputedStyle(b,null);parseInt(i.width)||T.width||(b.style.width=t(window.innerWidth)),parseInt(i.height)||T.height||(b.style.height=t(window.innerHeight))}else s="body",b=document.body;R=b?b.clientWidth:window.innerWidth,w=b?b.clientHeight:window.innerHeight,g=new THREE.WebGLRenderer({antialias:!0}),g.setClearColor("#000"),g.setSize(R,w),b.appendChild(g.domElement),M=new THREE.Scene,M.fog=new THREE.FogExp2(0,25e-5),v=new THREE.PerspectiveCamera(45,R/w,.01,1e4),v.position.z=3.5,v.position.y=2;var c=(new THREE.OrbitControls(v),new THREE.AmbientLight(16777215));M.add(c),f=d3.select(s).append("container");var u=E.Planets.create("sol");M.add(u),d3.json("data/planets.json",function(e,t){if(e)return console.log(e);for(var a in t)if(n(t,a)){var o={},s=j(r,t[a]);if(o.body=s,n(t[a],"trajectory")){var i=L(r,t[a]),c=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.VertexColors,transparent:!0,opacity:.6,fog:!0}),u=new THREE.Line(i,c);M.add(u),o.track=u}var l=E.Planets.create(a);l||(l=new THREE.Mesh(new THREE.SphereGeometry(.02,32,32),new THREE.MeshPhongMaterial({color:"#fff"}))),l.position.fromArray(s.pos),M.add(l),o.mesh=l}}),d3.json("data/sbo.json",function(e,t){if(e)return console.log(e);for(var a=(new THREE.TextureLoader).load("maps/ast.png"),o=[],s=[],i=.006,c=1;12>=c;c++)s.push(new THREE.Geometry),o.push(new THREE.PointsMaterial({color:16777215,map:a,blending:THREE.AdditiveBlending,size:i*c,transparent:!0,fog:!0}));for(var u in t)if(n(t,u)){var l=j(r,t[u]),h=new THREE.Vector3;h.fromArray(l.pos);var p=Math.floor(l.r);p>12&&(p=12),s[p-1].vertices.push(h)}for(c=0;12>c;c++)M.add(new THREE.Points(s[c],o[c]))}),z.push(function(){var e=v.position;M.fog.density=.05/Math.pow(e.x*e.x+e.y*e.y+e.z*e.z,.5),g.render(M,v)}),d()};window.addEventListener("resize",function(){g.setSize(R,w),v.aspect=R/w,v.updateProjectionMatrix()},!1);var k=null;S.display=N,this.Orrery=S}();